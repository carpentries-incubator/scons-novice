<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Automation and SCons: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="../assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="../assets/styles.css">
<script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../favicons/incubator/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicons/incubator/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../favicons/incubator/favicon-16x16.png">
<link rel="manifest" href="../favicons/incubator/site.webmanifest">
<link rel="mask-icon" href="../favicons/incubator/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="white">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="black">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Carpentries Incubator" src="../assets/images/incubator-logo.svg">
</div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
<li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul>
</li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='../aio.html';">Learner View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="../assets/images/incubator-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      Automation and SCons
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            Automation and SCons
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
<hr>
<li><a class="dropdown-item" href="discuss.html">Discussion</a></li>
<li><a class="dropdown-item" href="reference.html">References</a></li>
          </ul>
</li>
      </ul>
</div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="../instructor/aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Automation and SCons
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text">
<li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul>
</li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../aio.html">Learner View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->

            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-intro.html">1. Introduction</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-sconscript-files.html">2. SConscript files</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-variables.html">3. Special Substitution Variables</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-dependencies.html">4. Dependencies on Data and Code</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="05-builders.html">5. Builders and Pseudo-builders</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="06-variables.html">6. Variables</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="07-functions.html">7. Functions</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="08-self-doc.html">8. Self-Documenting SConstruct files</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush10">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading10">
        <a href="09-conclusion.html">9. Conclusion</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <hr>
<li><a class="dropdown-item" href="discuss.html">Discussion</a></li>
<li><a class="dropdown-item" href="reference.html">References</a></li>
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources">
<a href="../instructor/aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">

            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-01-intro"><p>Content from <a href="01-intro.html">Introduction</a></p>
<hr>
<p>Last updated on 2025-04-16 |

        <a href="https://github.com/swcarpentry/scons-novice/edit/main/episodes/01-intro.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 25 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I make my results easier to reproduce?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Explain what SCons is for.</li>
<li>Explain why SCons differs from shell scripts.</li>
<li>Name other popular build tools.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Let’s imagine that we’re interested in testing Zipf’s Law in some of
our favorite books.</p>
<div id="zipfs-law" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="zipfs-law" class="callout-inner">
<h3 class="callout-title">Zipf’s Law</h3>
<div class="callout-content">
<p>The most frequently-occurring word occurs approximately twice as
often as the second most frequent word. This is <a href="https://en.wikipedia.org/wiki/Zipf%27s_law" class="external-link">Zipf’s Law</a>.</p>
</div>
</div>
</div>
<p>We’ve compiled our raw data i.e. the books we want to analyze and
have prepared several Python scripts that together make up our analysis
pipeline.</p>
<p>Let’s take quick look at one of the books using the command
<code>head books/isles.txt</code>.</p>
<p>Our directory has the Python scripts and data files we will be
working with:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>|- books
|  |- abyss.txt
|  |- isles.txt
|  |- last.txt
|  |- LICENSE_TEXTS.md
|  |- sierra.txt
|- plotcounts.py
|- countwords.py
|- testzipf.py</code></pre>
</div>
<p>The first step is to count the frequency of each word in a book. For
this purpose we will use a python script <code>countwords.py</code>
which takes two command line arguments. The first argument is the input
file (<code>books/isles.txt</code>) and the second is the output file
that is generated (here <code>isles.dat</code>) by processing the
input.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">$</span> python countwords.py books/isles.txt isles.dat</span></code></pre>
</div>
<p>Let’s take a quick peek at the result.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">$</span> head <span class="at">-5</span> isles.dat</span></code></pre>
</div>
<p>This shows us the top 5 lines in the output file:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>the 3822 6.7371760973
of 2460 4.33632998414
and 1723 3.03719372466
to 1479 2.60708619778
a 1308 2.30565838181</code></pre>
</div>
<p>We can see that the file consists of one row per word. Each row shows
the word itself, the number of occurrences of that word, and the number
of occurrences as a percentage of the total number of words in the text
file.</p>
<p>We can do the same thing for a different book:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">$</span> python countwords.py books/abyss.txt abyss.dat</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="ex">$</span> head <span class="at">-5</span> abyss.dat</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>the 4044 6.35449402891
and 2807 4.41074795726
of 1907 2.99654305468
a 1594 2.50471401634
to 1515 2.38057825267</code></pre>
</div>
<p>Let’s visualize the results. The script <code>plotcounts.py</code>
reads in a data file and plots the 10 most frequently occurring words as
a text-based bar plot:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">$</span> python plotcounts.py isles.dat ascii</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>the   ########################################################################
of    ##############################################
and   ################################
to    ############################
a     #########################
in    ###################
is    #################
that  ############
by    ###########
it    ###########</code></pre>
</div>
<p><code>plotcounts.py</code> can also show the plot graphically:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">$</span> python plotcounts.py isles.dat show</span></code></pre>
</div>
<p>Close the window to exit the plot.</p>
<p><code>plotcounts.py</code> can also create the plot as an image file
(e.g. a PNG file):</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">$</span> python plotcounts.py isles.dat isles.png</span></code></pre>
</div>
<p>Finally, let’s test Zipf’s law for these books:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">$</span> python testzipf.py abyss.dat isles.dat</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Book	First	Second	Ratio
abyss	4044	2807	1.44
isles	3822	2460	1.55</code></pre>
</div>
<p>So we’re not too far off from Zipf’s law.</p>
<p>Together these scripts implement a common workflow:</p>
<ol style="list-style-type: decimal">
<li>Read a data file.</li>
<li>Perform an analysis on this data file.</li>
<li>Write the analysis results to a new file.</li>
<li>Plot a graph of the analysis results.</li>
<li>Save the graph as an image, so we can put it in a paper.</li>
<li>Make a summary table of the analyses</li>
</ol>
<p>Running <code>countwords.py</code> and <code>plotcounts.py</code> at
the shell prompt, as we have been doing, is fine for one or two files.
If, however, we had 5 or 10 or 20 text files, or if the number of steps
in the pipeline were to expand, this could turn into a lot of work.
Plus, no one wants to sit and wait for a command to finish, even just
for 30 seconds.</p>
<p>The most common solution to the tedium of data processing is to write
a shell script that runs the whole pipeline from start to finish.</p>
<p>So to reproduce the tasks that we have just done we create a new file
named <code>run_pipeline.sh</code> in which we place the commands one by
one. Using a text editor of your choice (e.g. for nano use the command
<code>nano run_pipeline.sh</code>) copy and paste the following text and
save it.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co"># USAGE: bash run_pipeline.sh</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="co"># to produce plots for isles and abyss</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="co"># and the summary table for the Zipf's law tests</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="ex">python</span> countwords.py books/isles.txt isles.dat</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="ex">python</span> countwords.py books/abyss.txt abyss.dat</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="ex">python</span> plotcounts.py isles.dat isles.png</span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="ex">python</span> plotcounts.py abyss.dat abyss.png</span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a><span class="co"># Generate summary table</span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a><span class="ex">python</span> testzipf.py abyss.dat isles.dat <span class="op">&gt;</span> results.txt</span></code></pre>
</div>
<p>Run the script and check that the output is the same as before:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="ex">$</span> bash run_pipeline.sh</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="ex">$</span> cat results.txt</span></code></pre>
</div>
<p>This shell script solves several problems in computational
reproducibility:</p>
<ol style="list-style-type: decimal">
<li>It explicitly documents our pipeline, making communication with
colleagues (and our future selves) more efficient.</li>
<li>It allows us to type a single command,
<code>bash run_pipeline.sh</code>, to reproduce the full analysis.</li>
<li>It prevents us from <em>repeating</em> typos or mistakes. You might
not get it right the first time, but once you fix something it’ll stay
fixed.</li>
</ol>
<p>Despite these benefits it has a few shortcomings.</p>
<p>Let’s adjust the width of the bars in our plot produced by
<code>plotcounts.py</code>.</p>
<p>Edit <code>plotcounts.py</code> so that the bars are 0.8 units wide
instead of 1 unit. (Hint: replace <code>width = 1.0</code> with
<code>width = 0.8</code> in the definition of
<code>plot_word_counts</code>.)</p>
<p>Now we want to recreate our figures. We <em>could</em> just
<code>bash run_pipeline.sh</code> again. That would work, but it could
also be a big pain if counting words takes more than a few seconds. The
word counting routine hasn’t changed; we shouldn’t need to recreate
those files.</p>
<p>Alternatively, we could manually rerun the plotting for each
word-count file. (Experienced shell scripters can make this easier on
themselves using a for-loop.)</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="cf">for</span> book <span class="kw">in</span> abyss isles<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>    <span class="ex">python</span> plotcounts.py <span class="va">$book</span>.dat <span class="va">$book</span>.png</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="cf">done</span></span></code></pre>
</div>
<p>With this approach, however, we don’t get many of the benefits of
having a shell script in the first place.</p>
<p>Another popular option is to comment out a subset of the lines in
<code>run_pipeline.sh</code>:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="co"># USAGE: bash run_pipeline.sh</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="co"># to produce plots for isles and abyss</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="co"># and the summary table for the Zipf's law tests.</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="co"># These lines are commented out because they don't need to be rerun.</span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="co">#python countwords.py books/isles.txt isles.dat</span></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a><span class="co">#python countwords.py books/abyss.txt abyss.dat</span></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="ex">python</span> plotcounts.py isles.dat isles.png</span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a><span class="ex">python</span> plotcounts.py abyss.dat abyss.png</span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a><span class="co"># Generate summary table</span></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a><span class="co"># This line is also commented out because it doesn't need to be rerun.</span></span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a><span class="co">#python testzipf.py abyss.dat isles.dat &gt; results.txt</span></span></code></pre>
</div>
<p>Then, we would run our modified shell script using
<code>bash run_pipeline.sh</code>.</p>
<p>But commenting out these lines, and subsequently uncommenting them,
can be a hassle and source of errors in complicated pipelines.</p>
<p>What we really want is an executable <em>description</em> of our
pipeline that allows software to do the tricky part for us: figuring out
what steps need to be rerun.</p>
<p>For our pipeline SCons can execute the commands needed to run our
analysis and plot our results. Like shell scripts it allows us to
execute complex sequences of commands via a single shell command. Unlike
shell scripts it explicitly records the dependencies between files -
what files are needed to create what other files - and so can determine
when to recreate our data files or image files, if our text files
change. SCons can be used for any commands that follow the general
pattern of processing files to create new files, for example:</p>
<ul>
<li>Run analysis scripts on raw data files to get data files that
summarize the raw data (e.g. creating files with word counts from book
text).</li>
<li>Run visualization scripts on data files to produce plots
(e.g. creating images of word counts).</li>
<li>Parse and combine text files and plots to create papers.</li>
<li>Compile source code into executable programs or libraries.</li>
</ul>
<p>There are now many build tools available, for example <a href="https://www.gnu.org/software/make/" class="external-link">GNU Make</a>, <a href="https://ant.apache.org/" class="external-link">Apache ANT</a>, <a href="https://pydoit.org/" class="external-link">doit</a>, and <a href="https://docs.microsoft.com/en-us/cpp/build/reference/nmake-reference" class="external-link">nmake</a>
for Windows. Which is best for you depends on your requirements,
intended usage, and operating system. However, they all share the same
fundamental concepts.</p>
<p>Also, you might come across build generation scripts e.g. <a href="https://www.gnu.org/software/autoconf/autoconf.html" class="external-link">GNU
Autoconf</a> and <a href="https://www.cmake.org/" class="external-link">CMake</a>. Those tools
do not run the pipelines directly, but rather generate files for use
with the build tools.</p>
<p>As a Python based build tool, SCons is available on Windows, MacOS,
and Linux. It is distributed with the <code>pip</code> and
<code>conda</code> package managers, so it can be installed in the same
Python scientific computing environments popular with computational
science and engineering communities. SCons also uses Python as the
configuration language, so the configuration files will feel familiar to
many students.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>SCons allows us to specify what depends on what and how to update
things that are out of date.</li>
</ul>
</div>
</div>
</div></section><section id="aio-02-sconscript-files"><p>Content from <a href="02-sconscript-files.html">SConscript files</a></p>
<hr>
<p>Last updated on 2025-04-16 |

        <a href="https://github.com/swcarpentry/scons-novice/edit/main/episodes/02-sconscript-files.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 40 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I write a simple SConstruct file?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Recognize the key parts of the SConstruct file, tasks, targets,
sources, and actions.</li>
<li>Write a simple SConstruct file.</li>
<li>Run SCons from the shell.</li>
<li>Explain how to create aliases for collections of targets.</li>
<li>Explain constraints on dependencies.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Create a file, called <code>SConstruct</code>, with the following
content:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>env <span class="op">=</span> Environment(ENV<span class="op">=</span>os.environ.copy())</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="co"># Count words.</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>env.Command(</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>    target<span class="op">=</span>[<span class="st">"isles.dat"</span>],</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>    source<span class="op">=</span>[<span class="st">"books/isles.txt"</span>],</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>    action<span class="op">=</span>[<span class="st">"python countwords.py books/isles.txt isles.dat"</span>],</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>)</span></code></pre>
</div>
<p>This is a <a href="reference.html#build-file">build file</a>, which
for SCons is called an <a href="reference.html#makefile">SConscript</a>
file - a file executed by SCons. <code>SConstruct</code> is the
conventional name for the root configuration file. Secondary
configuration files are named <code>SConscript</code> by convention, but
can take any filename. Together all SCons configuration files take the
generic name <code>SConscript</code> files. From now on, SCons
configuration files will be referred to collectively as
<code>SConscript</code> files, but it is important to remember that
projects usually start with the <code>SConstruct</code> file naming
convention.</p>
<p>The syntax should be familiar to <a href="https://www.python.org/" class="external-link">Python</a> users because SCons uses
Python as the configuration language. Note how the action resembles a
line from our shell script.</p>
<p>Let us go through each section in turn:</p>
<ul>
<li>First we import the <code>os</code> module and create an SCons <a href="https://scons.org/doc/production/HTML/scons-user.html#sect-construction-environments" class="external-link">construction
environment</a>. as a copy of the active shell environment. Most build
managers inherit the active shell environment by default. SCons requires
a little more effort, but this separation of construction environment
from the external environment is valuable in complex computational
science and engineering workflows which may require several mutually
exclusive environments in a single workflow. For the purposes of this
lesson, we will use a single construction environment inherited from the
shell’s active Conda environment.</li>
<li>
<code>#</code> denotes a <em>comment</em>. Any text from
<code>#</code> to the end of the line is ignored by SCons but could be
very helpful for anyone reading your SConstruct file.</li>
<li>
<code>env.Command</code> is the generic task definition class used
by SCons. Note that the task is defined inside the construction
environment we created earlier. If there were more than one construction
environment available, additional tasks could use unique, task specific,
construction environments.</li>
<li>
<code>isles.dat</code> is a <a href="reference.html#target">target</a>, a file to be created, or
built.</li>
<li>
<code>books/isles.txt</code> is a <a href="reference.html#source">source</a>, also called a <a href="reference.html#dependency">dependency</a>, a file that is needed
to build or update the target. Targets can have one or more
dependencies.</li>
<li>
<code>python countwords.py books/isles.txt isles.dat</code> is an <a href="reference.html#action">action</a>, a command to run to build or
update the target using the sources. Targets can have one or more
actions. These actions form a recipe to build the target from its
sources and are executed similarly to a shell script.</li>
<li>Targets, sources, and actions are passed as keyword arguments and
may be a string or a list of strings.</li>
<li>Together, the target, sources, and actions form a <a href="reference.html#task">task</a>.</li>
</ul>
<p>Our task above describes how to build the target
<code>isles.dat</code> using the action
<code>python countwords.py</code> and the source
<code>books/isles.txt</code>.</p>
<p>Information that was implicit in our shell script - that we are
generating a file called <code>isles.dat</code> and that creating this
file requires <code>books/isles.txt</code> - is now made explicit by
SCons’ syntax.</p>
<p>Let’s first ensure we start from scratch and delete the
<code>.dat</code> and <code>.png</code> files we created earlier:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">$</span> rm <span class="pp">*</span>.dat <span class="pp">*</span>.png</span></code></pre>
</div>
<p>By default, SCons looks for a root SConscript file, called
<code>SConstruct</code>, and we can run SCons as follows:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">$</span> scons</span></code></pre>
</div>
<p>By default, SCons prints several status messages and the actions it
executes:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Building targets ...
python countwords.py books/isles.txt isles.dat
scons: done building targets.</code></pre>
</div>
<p>The status messages can be silenced with the <code>-Q</code>
option.</p>
<p>Let’s see if we got what we expected.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">$</span> head <span class="at">-5</span> isles.dat</span></code></pre>
</div>
<p>The first 5 lines of <code>isles.dat</code> should look exactly like
before.</p>
<div id="the-sconstruct-file-does-not-have-to-be-called-sconstruct" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="the-sconstruct-file-does-not-have-to-be-called-sconstruct" class="callout-inner">
<h3 class="callout-title">The SConstruct File Does Not Have to be Called
<code>SConstruct</code>
</h3>
<div class="callout-content">
<p>We don’t have to call our root SCons configuration file
<code>SConstruct</code>. However, if we call it something else we need
to tell SCons where to find it. This we can do using
<code>--sconstruct</code> option. For example, if our SConstruct file is
named <code>MyOtherSConstruct</code>:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">$</span> scons <span class="at">--sconstruct</span><span class="op">=</span>MyOtherSConstruct</span></code></pre>
</div>
<p>SCons does not require a specific file extension. The suffix
<code>.scons</code> can be used to identify SConscript files that are
not called <code>SConstruct</code> or <code>SConscript</code>
e.g. <code>install.scons</code>, <code>common.scons</code> etc.</p>
</div>
</div>
</div>
<p>When we re-run our SConstruct file, SCons now informs us that:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Building targets ...
scons: `.' is up to date.
scons: done building targets.</code></pre>
</div>
<p>SCons uses the special target alias ‘<code>.</code>’ to indicate ‘all
targets’. No command is run because our target, <code>isles.dat</code>,
has now been created, and SCons will not create it again. To see how
this works, let’s pretend to update one of the text files. Rather than
opening the file in an editor, we can use the shell <code>touch</code>
command to update its timestamp (which would happen if we did edit the
file):</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">$</span> touch books/isles.txt</span></code></pre>
</div>
<p>If we compare the timestamps of <code>books/isles.txt</code> and
<code>isles.dat</code>,</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">$</span> ls <span class="at">-l</span> books/isles.txt isles.dat</span></code></pre>
</div>
<p>then we see that <code>isles.dat</code>, the target, is now older
than <code>books/isles.txt</code>, its dependency:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>-rw-r--r--    1 mjj      Administ   323972 Jun 12 10:35 books/isles.txt
-rw-r--r--    1 mjj      Administ   182273 Jun 12 09:58 isles.dat</code></pre>
</div>
<p>If we run SCons again,</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">$</span> scons</span></code></pre>
</div>
<p>it does not recreate <code>isles.dat</code>. Instead reporting that
‘all targets’ are up to date.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Building targets ...
scons: `.' is up to date.
scons: done building targets.</code></pre>
</div>
<p>This is a surprising result if you are already familiar with other
build managers. Many build managers, such as <a href="https://www.gnu.org/software/make/" class="external-link">GNU Make</a> use timestamps to
track the state of source and target files. If we were using Make, Make
would have re-created the <code>isles.dat</code> file.</p>
<p>By default SCons computes content signatures from the file content to
track the state of source and target files. If the content of a file has
not changed, it is considered up-to-date and SCons will not create it
again. Computing the content signature takes more time than checking a
timestamp, so SCons provides an option to use the more traditional
timestamp state. However, in computational science and engineering
workflows, which often contain tasks requiring hours or days to compute,
the added time required to check file content is often a valuable
trade-off because it avoids launching long-running tasks more robustly
than a simple timestamp check.</p>
<p>To observe SCons re-creating the target <code>isles.dat</code>, we
must actually modify the <code>books/isles.txt</code> file. Any change
to the file contents, even adding a newline, will change the content
signature computed as an <code>md5sum</code>. If we run the
<code>md5sum</code> ourselves, we can see the signature change before
and after the file edit.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="ex">$</span> md5sum books/isles.txt</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>6cc2c020856be849418f9d744ac1f5ee  books/isles.txt</code></pre>
</div>
<p>Append an empty newline to the <code>books/isles.txt</code> file and
check the <code>md5sum</code> signature again.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="ex">$</span> echo <span class="st">""</span> <span class="op">&gt;&gt;</span> books/isles.txt</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="ex">$</span> md5sum books/isles.txt</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>22b5adfc3b267e2e658ba75de4aeb74b  books/isles.txt</code></pre>
</div>
<p>We can see that appending a blank newline changes the computed
content signature. If we run SCons again, it will re-create
<code>isles.dat</code> because the content of the source file
<code>books/isles.txt</code> has changed.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="ex">$</span> scons</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Building targets ...
python countwords.py books/isles.txt isles.dat
scons: done building targets.</code></pre>
</div>
<p>When it is asked to build a target, SCons checks the ‘content
signature’ of both the target and its sources and the ‘action signature’
of the associated action list. If any source or action content has
changed since the target was built, then the actions are re-run to
update the target. Using this approach, SCons knows to only rebuild the
files that, either directly or indirectly, depend on the file that
changed. This is called an <a href="reference.html#incremental-build">incremental build</a>.</p>
<div id="sconscript-files-as-documentation" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="sconscript-files-as-documentation" class="callout-inner">
<h3 class="callout-title">SConscript Files as Documentation</h3>
<div class="callout-content">
<p>By explicitly recording the inputs to and outputs from steps in our
analysis and the dependencies between files, SConscript files act as a
type of documentation, reducing the number of things we have to
remember.</p>
</div>
</div>
</div>
<p>Let’s add another task to the end of <code>SConstruct</code>:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>env.Command(</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>    target<span class="op">=</span>[<span class="st">"abyss.dat"</span>],</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>    source<span class="op">=</span>[<span class="st">"books/abyss.txt"</span>],</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>	  action<span class="op">=</span>[<span class="st">"python countwords.py books/abyss.txt abyss.dat"</span>],</span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>)</span></code></pre>
</div>
<p>If we run SCons,</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="ex">$</span> scons</span></code></pre>
</div>
<p>then we get:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Building targets ...
python countwords.py books/abyss.txt abyss.dat
scons: done building targets.</code></pre>
</div>
<p>SCons builds the second target but not the first target. The default
behavior of SCons is to build all default targets and, unless otherwise
specified, all targets are added to the default targets list.</p>
<p>If we do not want to build all targets, we can also build a specific
target by name. First, confirm that running SCons again reports the
special target ‘<code>.</code>’ up to date to indicate that all targets
are up to date.</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="ex">$</span> scons</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Building targets ...
scons: `.' is up to date.
scons: done building targets.</code></pre>
</div>
<p>Then confirm that when specifying a target, SCons only reports on the
requested target.</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="ex">$</span> scons abyss.dat</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Building targets ...
scons: `abyss.dat' is up to date.
scons: done building targets.</code></pre>
</div>
<div id="up-to-date-versus-nothing-to-be-done" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="up-to-date-versus-nothing-to-be-done" class="callout-inner">
<h3 class="callout-title">“Up to Date” Versus “Nothing to be Done”</h3>
<div class="callout-content">
<p>If we ask SCons to build a file that already exists and is up to
date, then SCons informs us that:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>scons: `isles.dat' is up to date.</code></pre>
</div>
<p>If we ask SCons to build a file that exists but for which there is no
rule in our <code>SConstruct</code> file, then we get message like:</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="ex">$</span> scons countwords.py</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>scons: Nothing to be done for `countwords.py'.</code></pre>
</div>
<p><code>up to date</code> means that the <code>SConstruct</code> file
has a task with one or more actions whose target is the name of a file
(or directory) and the file is up to date.</p>
<p><code>Nothing to be done</code> means that the file exists but the
<code>SConstruct</code> file has no task for it. Targets that are
defined, but have no action, result in an empty ‘Building targets …’
message without issuing any commands.</p>
</div>
</div>
</div>
<p>We may want to remove all our data files so we can explicitly
recreate them all. SCons provides the <code>--clean</code> command line
option that will remove targets by request. We can clean all default
targets</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="ex">scons</span> <span class="at">--clean</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Cleaning targets ...
Removed abyss.dat
Removed isles.dat
scons: done cleaning targets.</code></pre>
</div>
<p>or clean all targets with the special target ‘<code>.</code>’,
regardless of the default list contents</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="ex">scons</span> . <span class="at">--clean</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Cleaning targets ...
Removed abyss.dat
Removed isles.dat
scons: done cleaning targets.</code></pre>
</div>
<p>or clean specific targets by name</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="ex">scons</span> abyss.dat <span class="at">--clean</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Cleaning targets ...
Removed abyss.dat
scons: done cleaning targets.</code></pre>
</div>
<p>We may want to simplify specification of some, but not all, targets.
We can add an alias to reference all of the data files.</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a>env.Alias(<span class="st">"dats"</span>, [<span class="st">"isles.dat"</span>, <span class="st">"abyss.dat"</span>])</span></code></pre>
</div>
<p>This simplifies calling a non-default target list such that we do not
have to write out each target by name. The following two executions of
SCons are equivalent.</p>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="ex">$</span> scons isles.dat abyss.dat</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a><span class="ex">$</span> scons dats</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Building targets ...
python countwords.py books/isles.txt isles.dat
python countwords.py books/abyss.txt abyss.dat
scons: done building targets.</code></pre>
</div>
<p>When requesting specific targets, the requested targets are reported
up-to-date according the name used on the command line. Calling two
targets by name results in individual reports, one per target.</p>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a><span class="ex">$</span> scons isles.dat abyss.dat</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Building targets ...
scons: `isles.dat' is up to date.
scons: `abyss.dat' is up to date.
scons: done building targets.</code></pre>
</div>
<p>Calling the collector alias <code>dats</code> results in a single
report for the alias.</p>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a><span class="ex">$</span> scons dats</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Building targets ...
scons: `dats' is up to date.
scons: done building targets.</code></pre>
</div>
<div id="dependencies" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="dependencies" class="callout-inner">
<h3 class="callout-title">Dependencies</h3>
<div class="callout-content">
<p>The order of rebuilding dependencies is arbitrary. Required sources
are always built before targets, but if two targets are independent of
one another, you should not assume that they will be built in the order
in which they are listed.</p>
<p>Dependencies must form a directed acyclic graph. A target cannot
depend on a dependency which itself, or one of its dependencies, depends
on that target.</p>
</div>
</div>
</div>
<p>Our <code>SConstruct</code> now looks like this:</p>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb43-2"><a href="#cb43-2" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" tabindex="-1"></a>env <span class="op">=</span> Environment(ENV<span class="op">=</span>os.environ.copy())</span>
<span id="cb43-4"><a href="#cb43-4" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" tabindex="-1"></a>env.Command(</span>
<span id="cb43-6"><a href="#cb43-6" tabindex="-1"></a>    target<span class="op">=</span>[<span class="st">"isles.dat"</span>],</span>
<span id="cb43-7"><a href="#cb43-7" tabindex="-1"></a>    source<span class="op">=</span>[<span class="st">"books/isles.txt"</span>],</span>
<span id="cb43-8"><a href="#cb43-8" tabindex="-1"></a>    action<span class="op">=</span>[<span class="st">"python countwords.py books/isles.txt isles.dat"</span>],</span>
<span id="cb43-9"><a href="#cb43-9" tabindex="-1"></a>)</span>
<span id="cb43-10"><a href="#cb43-10" tabindex="-1"></a></span>
<span id="cb43-11"><a href="#cb43-11" tabindex="-1"></a>env.Command(</span>
<span id="cb43-12"><a href="#cb43-12" tabindex="-1"></a>    target<span class="op">=</span>[<span class="st">"abyss.dat"</span>],</span>
<span id="cb43-13"><a href="#cb43-13" tabindex="-1"></a>    source<span class="op">=</span>[<span class="st">"books/abyss.txt"</span>],</span>
<span id="cb43-14"><a href="#cb43-14" tabindex="-1"></a>	  action<span class="op">=</span>[<span class="st">"python countwords.py books/abyss.txt abyss.dat"</span>],</span>
<span id="cb43-15"><a href="#cb43-15" tabindex="-1"></a>)</span>
<span id="cb43-16"><a href="#cb43-16" tabindex="-1"></a></span>
<span id="cb43-17"><a href="#cb43-17" tabindex="-1"></a>env.Alias(<span class="st">"dats"</span>, [<span class="st">"isles.dat"</span>, <span class="st">"abyss.dat"</span>])</span></code></pre>
</div>
<p>The following figure shows a graph of the dependencies embodied
within our SConstruct file, involved in building the <code>dats</code>
alias:</p>
<figure><img src="../fig/02-sconscript.png" title="Dependencies represented within the SConstruct file" alt="Dependencies represented within the SConstruct file" class="figure mx-auto d-block"></figure><div id="write-two-new-tasks" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="write-two-new-tasks" class="callout-inner">
<h3 class="callout-title">Write Two New Tasks</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li>Write a new task for <code>last.dat</code>, created from
<code>books/last.txt</code>.</li>
<li>Update the <code>dats</code> alias with this target.</li>
<li>Write a new task for <code>results.txt</code>, which creates the
summary table. The rule needs to:
<ul>
<li>Depend upon each of the three <code>.dat</code> files.</li>
<li>Invoke the action
<code>python testzipf.py abyss.dat isles.dat last.dat &gt; results.txt</code>.</li>
</ul>
</li>
<li>Add this target to the default target list so that it is the default
target.</li>
</ol>
<p>The starting SConstruct file is <a href="../files/code/02-sconscript-files/SConstruct">here</a>.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>See <a href="../files/code/02-sconscript-files-challenge/SConstruct">this file</a>
for a solution.</p>
</div>
</div>
</div>
</div>
<p>The following figure shows the dependencies embodied within our
SConstruct file, involved in building the <code>results.txt</code>
target:</p>
<figure><img src="../fig/02-sconscript-challenge.png" title="results.txt dependencies represented within the SConstruct file" alt="results.txt dependencies represented within the SConstruct file" class="figure mx-auto d-block"></figure><div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>SConstruct is the default name of the root SCons configuration
file</li>
<li>SCons configuration files are collectively called SConscript
files</li>
<li>SConscript files are Python files.</li>
<li>SCons tasks are attached to a construction environment, which can be
inherited from the shell’s active environment.</li>
<li>Use <code>#</code> for comments in SConscript files.</li>
<li>Write tasks as lists of targets, sources, and actions with the
<code>Command</code> class</li>
<li>Use an <code>Alias</code> to collect targets in a convenient alias
for shorter build commands.</li>
<li>Use the <code>Default</code> function to limit the number of default
targets to a subset of all targets.</li>
</ul>
</div>
</div>
</div></section><section id="aio-03-variables"><p>Content from <a href="03-variables.html">Special Substitution Variables</a></p>
<hr>
<p>Last updated on 2025-04-16 |

        <a href="https://github.com/swcarpentry/scons-novice/edit/main/episodes/03-variables.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 15 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I abbreviate the tasks in my SConscript files?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Use SCons special substitution variables to remove duplication in
SConscript files.</li>
<li>Explain why shell wildcards in dependencies can cause problems.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>After the exercise at the end of the previous episode, our SConstruct
file looked like this:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>env <span class="op">=</span> Environment(ENV<span class="op">=</span>os.environ.copy())</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>env.Command(</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>    target<span class="op">=</span>[<span class="st">"isles.dat"</span>],</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>    source<span class="op">=</span>[<span class="st">"books/isles.txt"</span>],</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>    action<span class="op">=</span>[<span class="st">"python countwords.py books/isles.txt isles.dat"</span>],</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>)</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>env.Command(</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>    target<span class="op">=</span>[<span class="st">"abyss.dat"</span>],</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>    source<span class="op">=</span>[<span class="st">"books/abyss.txt"</span>],</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>	action<span class="op">=</span>[<span class="st">"python countwords.py books/abyss.txt abyss.dat"</span>],</span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>)</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>env.Command(</span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>    target<span class="op">=</span>[<span class="st">"last.dat"</span>],</span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>    source<span class="op">=</span>[<span class="st">"books/last.txt"</span>],</span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>	action<span class="op">=</span>[<span class="st">"python countwords.py books/last.txt last.dat"</span>],</span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a>)</span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a>env.Alias(<span class="st">"dats"</span>, [<span class="st">"isles.dat"</span>, <span class="st">"abyss.dat"</span>, <span class="st">"last.dat"</span>])</span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a>env.Command(</span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a>    target<span class="op">=</span>[<span class="st">"results.txt"</span>],</span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a>    source<span class="op">=</span>[<span class="st">"isles.dat"</span>, <span class="st">"abyss.dat"</span>, <span class="st">"last.dat"</span>],</span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a>    action<span class="op">=</span>[<span class="st">"python testzipf.py abyss.dat isles.dat last.dat &gt; results.txt"</span>],</span>
<span id="cb1-29"><a href="#cb1-29" tabindex="-1"></a>)</span>
<span id="cb1-30"><a href="#cb1-30" tabindex="-1"></a></span>
<span id="cb1-31"><a href="#cb1-31" tabindex="-1"></a>env.Default([<span class="st">"results.txt"</span>])</span></code></pre>
</div>
<p>Our SConstruct file has a lot of duplication. For example, the names
of text files and data files are repeated in many places throughout the
file. SConscript files are a form of code and, in any code, repeated
code can lead to problems e.g. we rename a data file in one part of the
SConscript file but forget to rename it elsewhere.</p>
<div id="d.r.y.-dont-repeat-yourself" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="d.r.y.-dont-repeat-yourself" class="callout-inner">
<h3 class="callout-title">D.R.Y. (Don’t Repeat Yourself)</h3>
<div class="callout-content">
<p>In many programming languages, the bulk of the language features are
there to allow the programmer to describe long-winded computational
routines as short, expressive, beautiful code. Features in Python or R
or Java, such as user-defined variables and functions are useful in part
because they mean we don’t have to write out (or think about) all of the
details over and over again. This good habit of writing things out only
once is known as the “Don’t Repeat Yourself” principle or D.R.Y.</p>
</div>
</div>
</div>
<p>Let us set about removing some of the repetition from our SConstruct
file.</p>
<p>In our <code>results.txt</code> task we duplicate the data file names
and the name of the results file name:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>env.Command(</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>    target<span class="op">=</span>[<span class="st">"results.txt"</span>],</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>    source<span class="op">=</span>[<span class="st">"isles.dat"</span>, <span class="st">"abyss.dat"</span>, <span class="st">"last.dat"</span>],</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>    action<span class="op">=</span>[<span class="st">"python testzipf.py abyss.dat isles.dat last.dat &gt; results.txt"</span>],</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>)</span></code></pre>
</div>
<p>Looking at the results file name first, we can replace it in the
action with <code>${TARGET}</code>:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>env.Command(</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>    target<span class="op">=</span>[<span class="st">"results.txt"</span>],</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>    source<span class="op">=</span>[<span class="st">"isles.dat"</span>, <span class="st">"abyss.dat"</span>, <span class="st">"last.dat"</span>],</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>    action<span class="op">=</span>[<span class="st">"python testzipf.py abyss.dat isles.dat last.dat &gt; $</span><span class="sc">{TARGET}</span><span class="st">"</span>],</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>)</span></code></pre>
</div>
<p><code>${TARGET}</code> is an SCons <a href="reference.html#special-variable">special variable</a> which means
‘the target of the current task’. When SCons is run it will replace this
variable with the target name.</p>
<p>We can replace the sources in the action with
<code>${SOURCES}</code>:</p>
<pre class="make"><code>env.Command(
    target=["results.txt"],
    source=["isles.dat", "abyss.dat", "last.dat"],
    action=["python testzipf.py ${SOURCES} &gt; ${TARGET}"],
)</code></pre>
<p><code>${SOURCES}</code> is another special substitution variable
which means ‘all the dependencies of the current task’. Again, when
SCons is run it will replace this variable with the sources.</p>
<p>Let’s clean our workflow and re-run our task:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">$</span> scons . <span class="at">--clean</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="ex">$</span> scons results.txt</span></code></pre>
</div>
<p>We get:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Building targets ...
python countwords.py books/isles.txt isles.dat
python countwords.py books/abyss.txt abyss.dat
python countwords.py books/last.txt last.dat
python testzipf.py isles.dat abyss.dat last.dat &gt; results.txt
scons: done building targets.</code></pre>
</div>
<div id="update-dependencies" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="update-dependencies" class="callout-inner">
<h3 class="callout-title">Update Dependencies</h3>
<div class="callout-content">
<p>What will happen if you now execute:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">$</span> touch <span class="pp">*</span>.dat</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="ex">$</span> scons results.txt</span></code></pre>
</div>
<ol style="list-style-type: decimal">
<li>nothing</li>
<li>all files recreated</li>
<li>only <code>.dat</code> files recreated</li>
<li>only <code>results.txt</code> recreated</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>`<code>1.</code> Nothing.</p>
<p>The content of the <code>*.dat</code> has not changed, so
<code>results.txt</code> is up to date.</p>
<p>If you run:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">$</span> echo <span class="st">""</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> books/<span class="pp">*</span>.txt</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="ex">$</span> scons results.txt</span></code></pre>
</div>
<p>you will find that the <code>.dat</code> files as well as
<code>results.txt</code> are recreated.</p>
<p>If you run:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">$</span> echo <span class="st">"manually-edited-ouput-is-bad 1 0.1"</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="pp">*</span>.dat</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="ex">$</span> scons results.txt</span></code></pre>
</div>
<p>you will find that the <code>results.txt</code> file is recreated
because the content signature of the <code>.dat</code> files has
changed. However, the <code>.dat</code> files are not recreated. Despite
our edit, the source and action signatures of the <code>.dat</code>
tasks have not changed. It is important that you never edit targets
manually to avoid out-of-sync and reproducibility errors arising in the
middle of your workflow. You can rely on SCons to know when to rebuild
targets if you have well defined tasks with complete target and sources
lists</p>
<p>If you run this command or manually edited the <code>.dat</code>
files, be sure to clean and rebuild them to remove the manually edited
lines.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">scons</span> dats <span class="at">--clean</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="ex">scons</span> results.txt</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>As we saw, <code>${SOURCES}</code> means ‘all the dependencies of the
current task’. This works well for <code>results.txt</code> as its
action treats all the dependencies the same - as the input for the
<code>testzipf.py</code> script.</p>
<p>However, for some tasks, we may want to treat the first dependency
differently. For example, our tasks for <code>.dat</code> use their
first (and only) dependency specifically as the input file to
<code>countwords.py</code>. If we add additional dependencies (as we
will soon do) then we don’t want these being passed as input files to
<code>countwords.py</code> as it expects only one input file to be named
when it is invoked.</p>
<p>SCons allows Pythonic, zero-based indexing of special substitution
variables <code>${SOURCES}</code> and <code>${TARGETS}</code> for this
use case. For example, <code>${SOURCES[0]}</code> means ‘the first
dependency of the current task’.</p>
<div id="rewrite-.dat-tasks-to-use-special-substitution-variables" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="rewrite-.dat-tasks-to-use-special-substitution-variables" class="callout-inner">
<h3 class="callout-title">Rewrite <code>.dat</code> Tasks to Use Special
Substitution Variables</h3>
<div class="callout-content">
<p>Rewrite each <code>.dat</code> task to use the special substitution
variables <code>${TARGET}</code> (‘the target of the current task’) and
<code>${SOURCES[0]}</code> (‘the first dependency of the current task’).
<a href="../files/code/03-variables/SConstruct">This file</a> contains the
SConstruct immediately before the challenge.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>See <a href="../files/code/03-variables-challenge/SConstruct">this
file</a> for a solution to this challenge.</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Use <code>${TARGET}</code> to refer to the target of the current
task.</li>
<li>Use <code>${SOURCES}</code> to refer to the dependencies of the
current task.</li>
<li>Use <code>${SOURCES[0]}</code> to refer to the first dependency of
the current task.</li>
</ul>
</div>
</div>
</div></section><section id="aio-04-dependencies"><p>Content from <a href="04-dependencies.html">Dependencies on Data and Code</a></p>
<hr>
<p>Last updated on 2025-04-16 |

        <a href="https://github.com/swcarpentry/scons-novice/edit/main/episodes/04-dependencies.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 20 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I write an SConsript file to update things when my scripts
have changed rather than my input files?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Output files are a product not only of input files but of the
scripts or code that created the output files.</li>
<li>Recognize and avoid false dependencies.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Our SConstruct file now looks like this:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>env <span class="op">=</span> Environment(ENV<span class="op">=</span>os.environ.copy())</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>env.Command(</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>    target<span class="op">=</span>[<span class="st">"isles.dat"</span>],</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>    source<span class="op">=</span>[<span class="st">"books/isles.txt"</span>],</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>    action<span class="op">=</span>[<span class="st">"python countwords.py $</span><span class="sc">{SOURCES[0]}</span><span class="st"> $</span><span class="sc">{TARGET}</span><span class="st">"</span>],</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>)</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>env.Command(</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>    target<span class="op">=</span>[<span class="st">"abyss.dat"</span>],</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>    source<span class="op">=</span>[<span class="st">"books/abyss.txt"</span>],</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>	action<span class="op">=</span>[<span class="st">"python countwords.py $</span><span class="sc">{SOURCES[0]}</span><span class="st"> $</span><span class="sc">{TARGET}</span><span class="st">"</span>],</span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>)</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>env.Command(</span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>    target<span class="op">=</span>[<span class="st">"last.dat"</span>],</span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>    source<span class="op">=</span>[<span class="st">"books/last.txt"</span>],</span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>	action<span class="op">=</span>[<span class="st">"python countwords.py $</span><span class="sc">{SOURCES[0]}</span><span class="st"> $</span><span class="sc">{TARGET}</span><span class="st">"</span>],</span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a>)</span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a>env.Alias(<span class="st">"dats"</span>, [<span class="st">"isles.dat"</span>, <span class="st">"abyss.dat"</span>, <span class="st">"last.dat"</span>])</span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a>env.Command(</span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a>    target<span class="op">=</span>[<span class="st">"results.txt"</span>],</span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a>    source<span class="op">=</span>[<span class="st">"isles.dat"</span>, <span class="st">"abyss.dat"</span>, <span class="st">"last.dat"</span>],</span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a>    action<span class="op">=</span>[<span class="st">"python testzipf.py $</span><span class="sc">{SOURCES}</span><span class="st"> &gt; $</span><span class="sc">{TARGET}</span><span class="st">"</span>],</span>
<span id="cb1-29"><a href="#cb1-29" tabindex="-1"></a>)</span>
<span id="cb1-30"><a href="#cb1-30" tabindex="-1"></a></span>
<span id="cb1-31"><a href="#cb1-31" tabindex="-1"></a>env.Default([<span class="st">"results.txt"</span>])</span></code></pre>
</div>
<p>Our data files are produced using not only the input text files but
also the script <code>countwords.py</code> that processes the text files
and creates the data files. A change to <code>countwords.py</code>
(e.g. adding a new column of summary data or removing an existing one)
results in changes to the <code>.dat</code> files it outputs. So, let’s
pretend to edit <code>countwords.py</code>, using <code>echo</code> to
append a blank line, and re-run SCons:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">$</span> scons dats</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="ex">$</span> echo <span class="st">""</span> <span class="op">&gt;&gt;</span> countwords.py</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="ex">$</span> scons dats</span></code></pre>
</div>
<p>Nothing happens! Though we’ve updated <code>countwords.py</code> our
data files are not updated because our rules for creating
<code>.dat</code> files don’t record any dependencies on
<code>countwords.py</code>.</p>
<p>We need to add <code>countwords.py</code> as a dependency of each of
our data files also:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>env.Command(</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>    target<span class="op">=</span>[<span class="st">"isles.dat"</span>],</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>    source<span class="op">=</span>[<span class="st">"books/isles.txt"</span>, <span class="st">"countwords.py"</span>],</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>    action<span class="op">=</span>[<span class="st">"python countwords.py $</span><span class="sc">{SOURCES[0]}</span><span class="st"> $</span><span class="sc">{TARGET}</span><span class="st">"</span>],</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>)</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>env.Command(</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>    target<span class="op">=</span>[<span class="st">"abyss.dat"</span>],</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>    source<span class="op">=</span>[<span class="st">"books/abyss.txt"</span>, <span class="st">"countwords.py"</span>],</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>	action<span class="op">=</span>[<span class="st">"python countwords.py $</span><span class="sc">{SOURCES[0]}</span><span class="st"> $</span><span class="sc">{TARGET}</span><span class="st">"</span>],</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>)</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>env.Command(</span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>    target<span class="op">=</span>[<span class="st">"last.dat"</span>],</span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>    source<span class="op">=</span>[<span class="st">"books/last.txt"</span>, <span class="st">"countwords.py"</span>],</span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>	action<span class="op">=</span>[<span class="st">"python countwords.py $</span><span class="sc">{SOURCES[0]}</span><span class="st"> $</span><span class="sc">{TARGET}</span><span class="st">"</span>],</span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>)</span></code></pre>
</div>
<p>If we re-run SCons,</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">$</span> scons dats</span></code></pre>
</div>
<p>then we get:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Building targets ...
python countwords.py books/isles.txt isles.dat
python countwords.py books/abyss.txt abyss.dat
python countwords.py books/last.txt last.dat
scons: done building targets.</code></pre>
</div>
<p>SCons tracks the source list as part of the task signature. Adding a
new source triggers a rebuild of the targets. Now if we edit the
<code>countwords.py</code> file, the targets will re-build again.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">$</span> echo <span class="st">""</span> <span class="op">&gt;&gt;</span> countwords.py</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="ex">$</span> scons dats</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Building targets ...
python countwords.py books/isles.txt isles.dat
python countwords.py books/abyss.txt abyss.dat
python countwords.py books/last.txt last.dat
scons: done building targets.</code></pre>
</div>
<div id="dry-run" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="dry-run" class="callout-inner">
<h3 class="callout-title">Dry run</h3>
<div class="callout-content">
<p><code>scons</code> can show the commands it will execute without
actually running them if we pass the <code>--dry-run</code> flag:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">$</span> echo <span class="st">""</span> <span class="op">&gt;&gt;</span> countwords.py</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="ex">$</span> scons <span class="at">--dry-run</span> dats</span></code></pre>
</div>
<p>This gives the same output to the screen as without the
<code>--dry-run</code> flag, but the commands are not actually run.
Using this ‘dry-run’ mode is a good way to check that you have set up
your SConscript tasks properly before actually running the commands.</p>
<p>You can also get an explanation for why SCons would like to recreate
the targets with the <code>--debug=explain</code> option. This is
helpful when the dry run shows commands you did not expect to run and
you need help tracking down the incorrect task definition.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">$</span> echo <span class="st">""</span> <span class="op">&gt;&gt;</span> countwords.py</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="ex">$</span> scons <span class="at">--dry-run</span> <span class="at">--debug</span><span class="op">=</span>explain dats</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Building targets ...
scons: rebuilding `isles.dat' because `countwords.py' changed
python countwords.py books/isles.txt isles.dat
scons: rebuilding `abyss.dat' because `countwords.py' changed
python countwords.py books/abyss.txt abyss.dat
scons: rebuilding `last.dat' because `countwords.py' changed
python countwords.py books/last.txt last.dat
scons: done building targets.</code></pre>
</div>
</div>
</div>
</div>
<p>The following figure shows a graph of the dependencies that are
involved in building the target <code>results.txt</code>. Notice the
recently added dependencies <code>countwords.py</code> and
<code>testzipf.py</code>. This is how the SConstruct should look after
completing the rest of the exercises in this episode.</p>
<figure><img src="../fig/04-dependencies.png" title="results.txt dependencies after adding countwords.py and testzipf.py as dependencies" alt="results.txt dependencies after adding countwords.py and testzipf.py as dependencies" class="figure mx-auto d-block"></figure><div id="why-dont-the-.txt-files-depend-on-countwords.py" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="why-dont-the-.txt-files-depend-on-countwords.py" class="callout-inner">
<h3 class="callout-title">Why Don’t the <code>.txt</code> Files Depend
on <code>countwords.py</code>?</h3>
<div class="callout-content">
<p><code>.txt</code> files are input files and as such have no
dependencies. To make these depend on <code>countwords.py</code> would
introduce a <a href="reference.html#false-dependency">false
dependency</a> which is not desirable.</p>
</div>
</div>
</div>
<p>Intuitively, we should also add <code>countwords.py</code> as a
dependency for <code>results.txt</code>, because the final table should
be rebuilt if we remake the <code>.dat</code> files. However, it turns
out we don’t have to do that! Let’s see what happens to
<code>results.txt</code> when we update <code>countwords.py</code>:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">$</span> echo <span class="st">""</span> <span class="op">&gt;&gt;</span> countwords.py</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="ex">$</span> scons results.txt</span></code></pre>
</div>
<p>then we get:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Building targets ...
python countwords.py books/isles.txt isles.dat
python countwords.py books/abyss.txt abyss.dat
python countwords.py books/last.txt last.dat
scons: `results.txt' is up to date.
scons: done building targets.</code></pre>
</div>
<p>The whole pipeline is triggered, starting with the <code>.dat</code>
files and finishing with the requested <code>results.txt</code> file! To
understand this, note that according to the dependency figure,
<code>results.txt</code> depends on the <code>.dat</code> files. The
update of <code>countwords.py</code> triggers an update of the
<code>*.dat</code> files. Finally, SCons reports that the requested
<code>results.txt</code> file is still up to date.</p>
<p>In a timestamp based build manager, such as Make, the build manager
would see that the dependencies (the <code>.dat</code> files) are newer
than the target file (<code>results.txt</code>) and thus it recreates
<code>results.txt</code>.</p>
<p>With SCons, the <code>results.txt</code> file is not recreated
because the recreated intermediate <code>.dat</code> files contain the
same content as the first time we created the <code>results.txt</code>
file, which is therefore not out-of-date.</p>
<p>Both behaviors are examples of the power of a build manager: updating
a subset of the files in the pipeline triggers rerunning the appropriate
downstream steps. The additional SCons behavior of stopping a pipeline
early when intermediate file content has not changed is desirable for
computational science and engineering workflows, where some tasks may
require hours to days to complete.</p>
<div id="updating-one-input-file" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="updating-one-input-file" class="callout-inner">
<h3 class="callout-title">Updating One Input File</h3>
<div class="callout-content">
<p>What will happen if you now execute:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="ex">$</span> echo <span class="st">""</span> <span class="op">&gt;&gt;</span> books/last.txt</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="ex">$</span> scons results.txt</span></code></pre>
</div>
<ol style="list-style-type: decimal">
<li>only <code>last.dat</code> is recreated</li>
<li>all <code>.dat</code> files are recreated</li>
<li>only <code>last.dat</code> and <code>results.txt</code> are
recreated</li>
<li>all <code>.dat</code> and <code>results.txt</code> are
recreated</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p><code>1.</code> only <code>last.dat</code> is recreated.</p>
<p>Follow the dependency tree and consider the effect of an empty line
on the word count calculations to understand the answer(s).</p>
</div>
</div>
</div>
</div>
<div id="testzipf.py-as-a-dependency-of-results.txt." class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="testzipf.py-as-a-dependency-of-results.txt." class="callout-inner">
<h3 class="callout-title">
<code>testzipf.py</code> as a Dependency of
<code>results.txt</code>.</h3>
<div class="callout-content">
<p>What would happen if you added <code>testzipf.py</code> as dependency
of <code>results.txt</code>, and why?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>If you change the rule for the <code>results.txt</code> file like
this:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>env.Command(</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>    target<span class="op">=</span>[<span class="st">"results.txt"</span>],</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>    source<span class="op">=</span>[<span class="st">"isles.dat"</span>, <span class="st">"abyss.dat"</span>, <span class="st">"last.dat"</span>, <span class="st">"testzipf.py"</span>],</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>    action<span class="op">=</span>[<span class="st">"python testzipf.py $</span><span class="sc">{SOURCES}</span><span class="st"> &gt; $</span><span class="sc">{TARGET}</span><span class="st">"</span>],</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>)</span></code></pre>
</div>
<p><code>testzipf.py</code> becomes a part of <code>${SOURCES}</code>,
thus the post-substitution command becomes</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="ex">python</span> testzipf.py abyss.dat isles.dat last.dat testzipf.py <span class="op">&gt;</span> results.txt</span></code></pre>
</div>
<p>This results in an error from <code>testzipf.py</code> as it tries to
parse the script as if it were a <code>.dat</code> file. Try this by
running:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="ex">$</span> scons results.txt</span></code></pre>
</div>
<p>You’ll get</p>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Building targets ...
python testzipf.py isles.dat abyss.dat last.dat testzipf.py &gt; results.txt
Traceback (most recent call last):
  File "/home/roppenheimer/scons-lesson/testzipf.py", line 19, in &lt;module&gt;
    counts = load_word_counts(input_file)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/roppenheimer/scons-lesson/countwords.py", line 39, in load_word_counts
    counts.append((fields[0], int(fields[1]), float(fields[2])))
                              ^^^^^^^^^^^^^^
ValueError: invalid literal for int() with base 10: 'countwords'
scons: *** [results.txt] Error 1
scons: building terminated because of errors.</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>We still have to add the <code>testzipf.py</code> script as
dependency to <code>results.txt</code>. Given the answer to the
challenge above, we need to make a couple of small changes so that we
can still use special substitution variables.</p>
<p>We’ll move <code>testzipf.py</code> to be the first source. We could
then edit the action so that we pass all the dependencies as arguments
to python using <code>${SOURCES}</code>.</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>env.Command(</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>    target<span class="op">=</span>[<span class="st">"results.txt"</span>],</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>    source<span class="op">=</span>[<span class="st">"testzipf.py"</span>, <span class="st">"isles.dat"</span>, <span class="st">"abyss.dat"</span>, <span class="st">"last.dat"</span>],</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>    action<span class="op">=</span>[<span class="st">"python $</span><span class="sc">{SOURCES}</span><span class="st"> &gt; $</span><span class="sc">{TARGET}</span><span class="st">"</span>],</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>)</span></code></pre>
</div>
<p>But it would be helpful to clarify the unique role of the
<code>testzipf.py</code> as a Python script. We can clarify the intended
roles for different source files by indexing the sources in our action.
SCons allows for Pythonic slicing when indexing special substitution
variables.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>env.Command(</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>    target<span class="op">=</span>[<span class="st">"results.txt"</span>],</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>    source<span class="op">=</span>[<span class="st">"testzipf.py"</span>, <span class="st">"isles.dat"</span>, <span class="st">"abyss.dat"</span>, <span class="st">"last.dat"</span>],</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>    action<span class="op">=</span>[<span class="st">"python $</span><span class="sc">{SOURCES[0]}</span><span class="st"> $</span><span class="sc">{SOURCES[1:]}</span><span class="st"> &gt; $</span><span class="sc">{TARGET}</span><span class="st">"</span>],</span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>)</span></code></pre>
</div>
<div id="index-the-.dat-task-actions" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="index-the-.dat-task-actions" class="callout-inner">
<h3 class="callout-title">Index the <code>.dat</code> task actions</h3>
<div class="callout-content">
<p>Index the sources for <code>.dat</code> task actions without changing
the source file order. Remember that SCons allows Pythonic slicing when
indexing special substitution variables.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<p>SCons allows reverse indexing with the Python style <code>[-1]</code>
slice</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>    action<span class="op">=</span>[<span class="st">"python $</span><span class="sc">{SOURCES[-1]}</span><span class="st"> $</span><span class="sc">{SOURCES[0]}</span><span class="st"> $</span><span class="sc">{TARGET}</span><span class="st">"</span>],</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="where-we-are" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="where-we-are" class="callout-inner">
<h3 class="callout-title">Where We Are</h3>
<div class="callout-content">
<p><a href="../files/code/04-dependencies-challenge/SConstruct">This
SConstruct file</a> contains everything done so far in this topic.</p>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>SCons results depend on processing scripts as well as data
files.</li>
<li>Dependencies are transitive: if A depends on B and B depends on C, a
change to C will indirectly trigger the pipeline to update to A.</li>
<li>SCons content signatures help prevent recomputing work if
intermediate targets’ contents do not change after recreation.</li>
</ul>
</div>
</div>
</div></section><section id="aio-05-builders"><p>Content from <a href="05-builders.html">Builders and Pseudo-builders</a></p>
<hr>
<p>Last updated on 2025-04-16 |

        <a href="https://github.com/swcarpentry/scons-novice/edit/main/episodes/05-builders.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 10 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I define common task operations for similar files?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Write SCons builders and pseudo-builders</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Our SConstruct file still has repeated content. The task for each
<code>.dat</code> file are identical apart from the text and data file
names. We can replace these tasks with a single <a href="reference.html#builder">builder</a> which can be used to build any
<code>.dat</code> file from a <code>.txt</code> file in
<code>books/</code>:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>count_words_builder <span class="op">=</span> Builder(</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>    action<span class="op">=</span>[<span class="st">"python $</span><span class="sc">{SOURCES[-1]}</span><span class="st"> $</span><span class="sc">{SOURCES[0]}</span><span class="st"> $</span><span class="sc">{TARGET}</span><span class="st">"</span>],</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>)</span></code></pre>
</div>
<p>After creating the custom builder, we need to add it to the
construction environment to make it available for task definitions.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>env <span class="op">=</span> Environment(ENV<span class="op">=</span>os.environ.copy())</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>env.Append(BUILDERS<span class="op">=</span>{<span class="st">"CountWords"</span>: count_words_builder})</span></code></pre>
</div>
<p>Now we can convert our <code>.dat</code> tasks from the
<code>Command</code> to <code>CountWords</code> builder.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>env.CountWords(</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>    target<span class="op">=</span>[<span class="st">"isles.dat"</span>],</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>    source<span class="op">=</span>[<span class="st">"books/isles.txt"</span>, <span class="st">"countwords.py"</span>],</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>)</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>env.CountWords(</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>    target<span class="op">=</span>[<span class="st">"abyss.dat"</span>],</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>    source<span class="op">=</span>[<span class="st">"books/abyss.txt"</span>, <span class="st">"countwords.py"</span>],</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>)</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>env.CountWords(</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>    target<span class="op">=</span>[<span class="st">"last.dat"</span>],</span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>    source<span class="op">=</span>[<span class="st">"books/last.txt"</span>, <span class="st">"countwords.py"</span>],</span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>)</span></code></pre>
</div>
<p>Custom builders like <code>CountWords</code> allow us to apply the
same action to many tasks.</p>
<p>If we re-run SCons,</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">$</span> scons dats <span class="at">--clean</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="ex">$</span> scons dats</span></code></pre>
</div>
<p>then we get:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Building targets ...
python countwords.py books/isles.txt isles.dat
python countwords.py books/abyss.txt abyss.dat
python countwords.py books/last.txt last.dat
scons: done building targets.</code></pre>
</div>
<p>We can further simplify the task definition by moving the text file
handling inside a pseudo-builder function. Pseudo-builders behave like
builders, but allow flexibility in task construction through
user-defined arguments. We will use the <code>pathlib</code> module to
help us construct OS-agnostic paths and perform path manipulation.</p>
<p>At the top of your <code>SConstruct</code> file, update the imports
as below. Then define a new <code>count_words</code> pseudo-builder
function after the imports to replace the
<code>count_word_builder</code> and add it to the construction
environment.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="im">import</span> pathlib</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="kw">def</span> count_words(env, data_file):</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>    <span class="co">"""Pseudo-builder to run the `countwords.py` script and produce `.dat` target</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="co">    Assumes that the source text file is found in `books/{data_file}.txt`</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="co">    :param env: SCons construction environment. Do not provide when using this</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="co">        function with the `env.AddMethod` and `env.CountWords` access style.</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="co">    :param data_file: String name of the data file to create.</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>    data_path <span class="op">=</span> pathlib.Path(data_file)</span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>    text_file <span class="op">=</span> pathlib.Path(<span class="st">"books"</span>) <span class="op">/</span> data_path.with_suffix(<span class="st">".txt"</span>)</span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a>    target_nodes <span class="op">=</span> env.Command(</span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a>        target<span class="op">=</span>[data_file],</span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a>        source<span class="op">=</span>[text_file, <span class="st">"countwords.py"</span>],</span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a>        action<span class="op">=</span>[<span class="st">"python $</span><span class="sc">{SOURCES[-1]}</span><span class="st"> $</span><span class="sc">{SOURCES[0]}</span><span class="st"> $</span><span class="sc">{TARGET}</span><span class="st">"</span>],</span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a>    )</span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a>    <span class="cf">return</span> target_nodes</span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a>env <span class="op">=</span> Environment(ENV<span class="op">=</span>os.environ.copy())</span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a>env.AddMethod(count_words, <span class="st">"CountWords"</span>)</span></code></pre>
</div>
<p>This pseudo-builder has further reduced the interface necessary to
define the <code>.dat</code> tasks, which now can be re-written as</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>env.CountWords(<span class="st">"isles.dat"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>env.CountWords(<span class="st">"abyss.dat"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>env.CountWords(<span class="st">"last.dat"</span>)</span></code></pre>
</div>
<p>For students familiar with GNU Make, pseudo-builders are similar to
Make ‘pattern rules’, but pseudo-builders are both more verbose and more
flexible. Pseudo-builders require a full Python function definition
syntax, but they can do more than simple file extension pattern matching
and anything the user requires.</p>
<p>A psuedo-builder alone will not allow us to match arbitrary files
using the <code>.dat</code> file extension. If we desire the full Make
‘pattern rule’ behavior, we can accept a target name and match it to our
pseudo-builder with the SCons <a href="https://scons.org/doc/production/HTML/scons-user.html#sect-var-COMMAND-LINE-TARGETS" class="external-link"><code>COMMAND_LINE_TARGETS</code></a>
variable.</p>
<p>Add the following to the bottom of your SConstruct file</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="cf">for</span> target <span class="kw">in</span> COMMAND_LINE_TARGETS:</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>    <span class="cf">if</span> pathlib.Path(target).suffix <span class="op">==</span> <span class="st">".dat"</span>:</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>        env.CountWords(target)</span></code></pre>
</div>
<p>Now we can define tasks for new files not found in our pre-defined
tasks as</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">$</span> scons sierra.dat</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Building targets ...
python countwords.py books/sierra.txt sierra.dat
scons: done building targets.</code></pre>
</div>
<div id="where-we-are" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="where-we-are" class="callout-inner">
<h3 class="callout-title">Where We Are</h3>
<div class="callout-content">
<p><a href="../files/code/05-builders-patterns/SConstruct">This SConstruct
file</a> contains all of our work so far.</p>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Use the <code>Builder</code> function and <code>Append</code> the
construction environment <code>BUILDERS</code> dictionary to define
common actions.</li>
<li>Use the <code>AddMethod</code> function and Python functions to
define pseudo-builders with custom tailored task handling.</li>
<li>Use the special SCons variable <code>COMMAND_LINE_TARGETS</code> to
perform dynamic handling that depends on command line target
requests.</li>
</ul>
</div>
</div>
</div></section><section id="aio-06-variables"><p>Content from <a href="06-variables.html">Variables</a></p>
<hr>
<p>Last updated on 2025-04-16 |

        <a href="https://github.com/swcarpentry/scons-novice/edit/main/episodes/06-variables.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 20 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I eliminate redundancy in my SConscript files?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Use variables in SConscript files.</li>
<li>Explain the benefits of decoupling configuration from
computation.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Despite our efforts, our SConstruct still has repeated content,
i.e. the program we use to run our scripts, <code>python</code>.
Additionally, if we renamed our scripts we’d have to hunt through our
SConstruct file in multiple places.</p>
<p>We can introduce Python <a href="reference.html#variable">variables</a> after the import statements
in <code>SConstruct</code> to hold our script name:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>COUNT_SOURCE <span class="op">=</span> <span class="st">"countwords.py"</span></span></code></pre>
</div>
<p>This is a variable <a href="reference.html#assignment">assignment</a>
- <code>COUNT_SOURCE</code> is assigned the value
<code>"countwords.py"</code> and behaves like (actually is) normal
Python variable assignment. The all capitals naming convention indicates
that the variable is intended for use as a setting or constant
value.</p>
<p>We can do the same thing with the interpreter language used to run
the script:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>LANGUAGE <span class="op">=</span> <span class="st">"python"</span></span></code></pre>
</div>
<p>Similar to the SCons special substitution variables, we can define
any number of per-task or per-builder substitution variables with
keyword arguments. The same <code>${...}</code> substitution syntax
tells SCons to replace a task action string variable with its value when
SCons is run.</p>
<p>Defining the variable <code>LANGUAGE</code> in this way avoids
repeating <code>python</code> in our SConstruct file, and allows us to
easily change how our script is run (e.g. we might want to use a
different version of Python and need to change <code>python</code> to
<code>python2</code> – or we might want to rewrite the script using
another language (e.g. switch from Python to R)).</p>
<p>In the <code>count_words</code> pseudo-builder function we will
define optional arguments <code>language</code> and
<code>count_source</code>, which are defined to default as
<code>LANGUAGE</code> and <code>COUNT_SOURCE</code> respectively and
passed through as <code>Command</code> task keyword arguments. This
tells SCons to replace the variable <code>language</code> with its value
<code>python</code>, and to replace the variable
<code>count_source</code> with its value <code>countwords.py</code>.</p>
<p>We will define and use the intermediate function keyword argument
variables instead of using the upper case variables directly to avoid
mixing up the function’s scope with the <code>SConstruct</code> scope.
This is a detail of good practice in Python development, and since
SConscript files are Python code, you should follow the usual Python
practices and style guides wherever possible.</p>
<div id="use-variables" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="use-variables" class="callout-inner">
<h3 class="callout-title">Use Variables</h3>
<div class="callout-content">
<p>Update <code>SConstruct</code> so that the <code>.dat</code> rule
references the variable <code>count_source</code> and
<code>language</code>. Then do the same for the <code>testzipf.py</code>
script and the <code>results.txt</code> rule, using
<code>ZIPF_SOURCE</code> as the variable name.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p><a href="../files/code/06-variables-challenge/SConstruct">This
SConstruct file</a> contains a solution to this challenge.</p>
</div>
</div>
</div>
</div>
<p>We place variables intended for use as configuration constants at the
top of an SConstruct file so they are easy to find and modify.
Alternatively, we can pull them out into a new file that just holds
variable definitions (i.e. delete them from the original SConstruct
file). Because SCons uses Python as the configuration language, we can
also move our custom builders and psuedo-builders. Let us create
<code>scons_lesson_configuration.py</code> from the content below.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="im">import</span> pathlib</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>COUNT_SOURCE <span class="op">=</span> <span class="st">"countwords.py"</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>LANGUAGE <span class="op">=</span> <span class="st">"python"</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>ZIPF_SOURCE <span class="op">=</span> <span class="st">"testzipf.py"</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="kw">def</span> count_words(env, data_file, language<span class="op">=</span>LANGUAGE, count_source<span class="op">=</span>COUNT_SOURCE):</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>    <span class="co">"""Pseudo-builder to produce `.dat` targets from the `countwords.py` script</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="co">    Assumes that the source text file is found in `books/{data_file}.txt`</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="co">    :param env: SCons construction environment. Do not provide when using this</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="co">        function with the `env.AddMethod` and `env.CountWords` access style.</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a><span class="co">    :param data_file: String name of the data file to create.</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>    data_path <span class="op">=</span> pathlib.Path(data_file)</span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a>    text_file <span class="op">=</span> pathlib.Path(<span class="st">"books"</span>) <span class="op">/</span> data_path.with_suffix(<span class="st">".txt"</span>)</span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a>    target_nodes <span class="op">=</span> env.Command(</span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a>        target<span class="op">=</span>[data_file],</span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a>        source<span class="op">=</span>[text_file, count_source],</span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a>        action<span class="op">=</span>[<span class="st">"$</span><span class="sc">{language}</span><span class="st"> $</span><span class="sc">{count_source}</span><span class="st"> $</span><span class="sc">{SOURCES[0]}</span><span class="st"> $</span><span class="sc">{TARGET}</span><span class="st">"</span>],</span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a>        language<span class="op">=</span>language,</span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a>        count_source<span class="op">=</span>count_source,</span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a>    )</span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a>    <span class="cf">return</span> target_nodes</span></code></pre>
</div>
<p>An added benefit to moving our custom functions into a file with the
<code>.py</code> extension is that we can use automated documentation
tools, such as <a href="https://www.sphinx-doc.org/en/master/" class="external-link">Sphinx</a>, to build
project documentation.</p>
<p>We can then import <code>scons_lesson_configuration.py</code> into
the SConstruct file with a standard Python import:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="im">from</span> scons_lesson_configuration <span class="im">import</span> <span class="op">*</span></span></code></pre>
</div>
<p>Note that the above import statement merges the module namespace into
the SConstruct file namespace. We must be careful to avoid re-defining
variable and function names provided by
<code>scons_lesson_configuration.py</code> in our
<code>SConstruct</code> file, which would overwrite the names provided
by our module and lead to unexpected behavior.</p>
<p>We can re-run SCons to see that everything still works:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">$</span> scons . <span class="at">--clean</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="ex">$</span> scons dats</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="ex">$</span> scons results.txt</span></code></pre>
</div>
<div id="where-we-are" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="where-we-are" class="callout-inner">
<h3 class="callout-title">Where We Are</h3>
<div class="callout-content">
<p><a href="../files/code/06-variables/SConstruct">This SConstruct file</a>
and this <a href="../files/code/06-variables/scons_lesson_configuration.py">Python
module</a> contain all of our work so far.</p>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Define variables by assigning values to names with Python
syntax</li>
<li>Reference variables in action strings using SCons substitution
syntax <code>${...}</code>.</li>
</ul>
</div>
</div>
</div></section><section id="aio-07-functions"><p>Content from <a href="07-functions.html">Functions</a></p>
<hr>
<p>Last updated on 2025-04-16 |

        <a href="https://github.com/swcarpentry/scons-novice/edit/main/episodes/07-functions.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 25 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How <em>else</em> can I eliminate redundancy in my SConscript
files?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Write SConscript files that use functions to match and transform
sets of files.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>At this point, we have the following SConstruct file:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="im">import</span> pathlib</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="im">from</span> scons_lesson_configuration <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>env <span class="op">=</span> Environment(ENV<span class="op">=</span>os.environ.copy())</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>env.AddMethod(count_words, <span class="st">"CountWords"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>env.CountWords(<span class="st">"isles.dat"</span>)</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>env.CountWords(<span class="st">"abyss.dat"</span>)</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>env.CountWords(<span class="st">"last.dat"</span>)</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>env.Alias(<span class="st">"dats"</span>, [<span class="st">"isles.dat"</span>, <span class="st">"abyss.dat"</span>, <span class="st">"last.dat"</span>])</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>env.Command(</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>    target<span class="op">=</span>[<span class="st">"results.txt"</span>],</span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>    source<span class="op">=</span>[ZIPF_SOURCE, <span class="st">"isles.dat"</span>, <span class="st">"abyss.dat"</span>, <span class="st">"last.dat"</span>],</span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>    action<span class="op">=</span>[<span class="st">"$</span><span class="sc">{language}</span><span class="st"> $</span><span class="sc">{zipf_source}</span><span class="st"> $</span><span class="sc">{SOURCES[1:]}</span><span class="st"> &gt; $</span><span class="sc">{TARGET}</span><span class="st">"</span>],</span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>    language<span class="op">=</span>LANGUAGE,</span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>    zipf_source<span class="op">=</span>ZIPF_SOURCE,</span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a>)</span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a>env.Default([<span class="st">"results.txt"</span>])</span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a><span class="cf">for</span> target <span class="kw">in</span> COMMAND_LINE_TARGETS:</span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a>    <span class="cf">if</span> pathlib.Path(target).suffix <span class="op">==</span> <span class="st">".dat"</span>:</span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a>        env.CountWords(target)</span></code></pre>
</div>
<p>Python and SCons have many <a href="reference.html#function">functions</a> which can be used to write
more complex tasks. One example is <code>Glob</code>. <code>Glob</code>
gets a list of files matching some pattern, which we can then save in a
variable. So, for example, we can get a list of all our text files
(files ending in <code>.txt</code>) and save these in a variable by
updating the beginning of our <code>scons_lesson_configuration.py</code>
file:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="im">import</span> pathlib</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="im">import</span> SCons.Script</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>COUNT_SOURCE <span class="op">=</span> <span class="st">"countwords.py"</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>LANGUAGE <span class="op">=</span> <span class="st">"python"</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>ZIPF_SOURCE <span class="op">=</span> <span class="st">"testzipf.py"</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>TEXT_FILES <span class="op">=</span> SCons.Script.Glob(<span class="st">"books/*.txt"</span>)</span></code></pre>
</div>
<p>Because our new Python module is no longer part of the SConstruct
file, it does not have direct access to the special SCons namespace. We
need to import SCons like a Python package to use the <code>Glob</code>
function.</p>
<p>We can add a <a href="https://scons.org/doc/production/HTML/scons-user.html#sect-AddOption" class="external-link">custom
command-line option</a> <code>--variables</code> to our SConstruct file
to print the <code>TEXT_FILES</code> value and exit configuration prior
to building using Python <a href="https://docs.python.org/3/tutorial/inputoutput.html#formatted-string-literals" class="external-link">f-string</a>
syntax:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>AddOption(</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>    <span class="st">"--variables"</span>,</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>    action<span class="op">=</span><span class="st">"store_true"</span>,</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>    <span class="bu">help</span><span class="op">=</span><span class="st">"Print the text files returned by Glob and exit (default: </span><span class="sc">%default</span><span class="st">)"</span>,</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>)</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="cf">if</span> GetOption(<span class="st">"variables"</span>):</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>    text_file_strings <span class="op">=</span> [<span class="bu">str</span>(node) <span class="cf">for</span> node <span class="kw">in</span> TEXT_FILES]</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"TEXT_FILES: </span><span class="sc">{</span>text_file_strings<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>    Exit(<span class="dv">0</span>)</span></code></pre>
</div>
<div id="print-and-exit" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="print-and-exit" class="callout-inner">
<h3 class="callout-title">print and Exit</h3>
<div class="callout-content">
<p>We can use the Python built-in <code>print</code> function to print
to STDOUT, which is our terminal by default. If we needed to execute a
shell command, we could also use the <a href="https://scons.org/doc/production/HTML/scons-user.html#id1419" class="external-link"><code>Execute</code></a>
function to run a command immediately during configuration instead of
defining a task.</p>
<p>The SCons <code>Exit</code> function exits the configuration
immediately. Here we use zero as the conventional ‘success’ code of most
shells because the intended behavior of the <code>--text-file</code>
option is documented as an early exit from configuration.</p>
</div>
</div>
</div>
<p>If we run SCons:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">$</span> scons <span class="at">--variables</span></span></code></pre>
</div>
<p>We get:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>scons: Reading SConscript files ...
TEXT_FILES: ['books/abyss.txt', 'books/isles.txt', 'books/last.txt', 'books/sierra.txt']</code></pre>
</div>
<p>Note how <code>sierra.txt</code> is now included too. There are some
progress messages missing from the output due to the early
<code>Exit</code>. The configuration phase is exited immediately and
there is no build phase.</p>
<p>We can construct a list of data files with a list comprehension that
performs path manipulation of the text files list to the
<code>scons_lesson_configuration.py</code> module. We will use the
<code>pathlib</code> module again for OS-agnostic path separators.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>DATA_FILES <span class="op">=</span> [</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>    pathlib.Path(<span class="bu">str</span>(text_file)).with_suffix(<span class="st">".dat"</span>).name</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>    <span class="cf">for</span> text_file <span class="kw">in</span> TEXT_FILES</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>]</span></code></pre>
</div>
<p>We can extend the <code>--variables</code> option in SConstruct file
to show the value of <code>DATA_FILES</code> too. We cast the SCons node
objects into a string, then create a <code>pathlib.Path</code> object,
and finally trim the parent directory to get our data file name. These
operations return a list of strings, so we can <code>print</code> the
list directly.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="cf">if</span> GetOption(<span class="st">"variables"</span>):</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>    text_file_strings <span class="op">=</span> [<span class="bu">str</span>(node) <span class="cf">for</span> node <span class="kw">in</span> TEXT_FILES]</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"TEXT_FILES: </span><span class="sc">{</span>text_file_strings<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"DATA_FILES: </span><span class="sc">{</span>DATA_FILES<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>    Exit(<span class="dv">0</span>)</span></code></pre>
</div>
<p>If we run SCons,</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">$</span> scons <span class="at">--variables</span></span></code></pre>
</div>
<p>then we get:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>scons: Reading SConscript files ...
TEXT_FILES: ['books/abyss.txt', 'books/isles.txt', 'books/last.txt', 'books/sierra.txt']
DATA_FILES: ['abyss.dat', 'isles.dat', 'last.dat', 'sierra.dat']</code></pre>
</div>
<p>Finally, we can update our <code>count_words</code> function in
<code>scons_lesson_configuration.py</code> to accept a list of data
files and reduce our <code>CountWords</code> function calls to a single
instance in <code>SConstruct</code>. We will have to collect the target
nodes returned by <code>Command</code> and compile the full list of
target nodes to return from our psuedo-builder.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="kw">def</span> count_words(env, data_files, language<span class="op">=</span>LANGUAGE, count_source<span class="op">=</span>COUNT_SOURCE):</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>    <span class="co">"""Pseudo-builder to produce `.dat` targets from the `countwords.py` script</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="co">    Assumes that the source text files are found in `books/{data_file}.txt`</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="co">    :param env: SCons construction environment. Do not provide when using this</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="co">        function with the `env.AddMethod` and `env.CountWords` access style.</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="co">    :param data_files: List of string names of the data files to create.</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>    target_nodes <span class="op">=</span> []</span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a>    <span class="cf">for</span> data_file <span class="kw">in</span> data_files:</span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a>        data_path <span class="op">=</span> pathlib.Path(data_file)</span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a>        text_file <span class="op">=</span> pathlib.Path(<span class="st">"books"</span>) <span class="op">/</span> data_path.with_suffix(<span class="st">".txt"</span>)</span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a>        target_nodes.extend(</span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a>            env.Command(</span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a>                target<span class="op">=</span>[data_file],</span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a>                source<span class="op">=</span>[text_file, count_source],</span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a>                action<span class="op">=</span>[<span class="st">"$</span><span class="sc">{language}</span><span class="st"> $</span><span class="sc">{count_source}</span><span class="st"> $</span><span class="sc">{SOURCES[0]}</span><span class="st"> $</span><span class="sc">{TARGET}</span><span class="st">"</span>],</span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a>                language<span class="op">=</span>language,</span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a>                count_source<span class="op">=</span>count_source,</span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a>            )</span>
<span id="cb10-22"><a href="#cb10-22" tabindex="-1"></a>        )</span>
<span id="cb10-23"><a href="#cb10-23" tabindex="-1"></a>    <span class="cf">return</span> target_nodes</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>env <span class="op">=</span> Environment(ENV<span class="op">=</span>os.environ.copy())</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>env.AddMethod(count_words, <span class="st">"CountWords"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>env.CountWords(DATA_FILES)</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>env.Alias(<span class="st">"dats"</span>, DATA_FILES)</span></code></pre>
</div>
<p>Now, <code>sierra.txt</code> is processed, too. If you update the
<code>Alias</code> function call, we can process all <code>.txt</code>
files with the same <code>dats</code> alias. The
<code>COMMAND_LIST_TARGETS</code> loop is no longer required and may be
removed.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">$</span> scons dats <span class="at">--clean</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="ex">$</span> scons dats</span></code></pre>
</div>
<p>We get:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Building targets ...
python countwords.py books/abyss.txt abyss.dat
python countwords.py books/isles.txt isles.dat
python countwords.py books/last.txt last.dat
python countwords.py books/sierra.txt sierra.dat
scons: done building targets.</code></pre>
</div>
<p>We can also rewrite <code>results.txt</code>:</p>
<pre class="make"><code>env.Command(
    target=["results.txt"],
    source=[ZIPF_SOURCE] + DATA_FILES,
    action=["${language} ${zipf_source} ${SOURCES[1:]} &gt; ${TARGET}"],
    language=LANGUAGE,
    zipf_source=ZIPF_SOURCE,
)</code></pre>
<p>If we re-run SCons:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="ex">$</span> scons . <span class="at">--clean</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="ex">$</span> scons results.txt</span></code></pre>
</div>
<p>We get:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Building targets ...
python countwords.py books/abyss.txt abyss.dat
python countwords.py books/isles.txt isles.dat
python countwords.py books/last.txt last.dat
python countwords.py books/sierra.txt sierra.dat
python testzipf.py abyss.dat isles.dat last.dat sierra.dat &gt; results.txt
scons: done building targets.</code></pre>
</div>
<p>Let’s check the <code>results.txt</code> file:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="ex">$</span> cat results.txt</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Book	First	Second	Ratio
abyss	4044	2807	1.44
isles	3822	2460	1.55
last	12244	5566	2.20
sierra	4242	2469	1.72</code></pre>
</div>
<p>So the range of the ratios of occurrences of the two most frequent
words in our books is indeed around 2, as predicted by Zipf’s Law, i.e.,
the most frequently-occurring word occurs approximately twice as often
as the second most frequent word.</p>
<p>Here is our final SConstruct file:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="im">import</span> pathlib</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="im">from</span> scons_lesson_configuration <span class="im">import</span> <span class="op">*</span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>AddOption(</span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a>    <span class="st">"--variables"</span>,</span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a>    action<span class="op">=</span><span class="st">"store_true"</span>,</span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a>    default<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a>    <span class="bu">help</span><span class="op">=</span><span class="st">"Print the files returned by Glob and exit (default: '</span><span class="sc">%default</span><span class="st">')"</span>,</span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a>)</span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a><span class="cf">if</span> GetOption(<span class="st">"variables"</span>):</span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a>    text_file_strings <span class="op">=</span> [<span class="bu">str</span>(node) <span class="cf">for</span> node <span class="kw">in</span> TEXT_FILES]</span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"TEXT_FILES: </span><span class="sc">{</span>text_file_strings<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"DATA_FILES: </span><span class="sc">{</span>DATA_FILES<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-16"><a href="#cb19-16" tabindex="-1"></a>    Exit(<span class="dv">0</span>)</span>
<span id="cb19-17"><a href="#cb19-17" tabindex="-1"></a></span>
<span id="cb19-18"><a href="#cb19-18" tabindex="-1"></a>env <span class="op">=</span> Environment(ENV<span class="op">=</span>os.environ.copy())</span>
<span id="cb19-19"><a href="#cb19-19" tabindex="-1"></a>env.AddMethod(count_words, <span class="st">"CountWords"</span>)</span>
<span id="cb19-20"><a href="#cb19-20" tabindex="-1"></a></span>
<span id="cb19-21"><a href="#cb19-21" tabindex="-1"></a>env.CountWords(DATA_FILES)</span>
<span id="cb19-22"><a href="#cb19-22" tabindex="-1"></a></span>
<span id="cb19-23"><a href="#cb19-23" tabindex="-1"></a>env.Alias(<span class="st">"dats"</span>, DATA_FILES)</span>
<span id="cb19-24"><a href="#cb19-24" tabindex="-1"></a></span>
<span id="cb19-25"><a href="#cb19-25" tabindex="-1"></a>env.Command(</span>
<span id="cb19-26"><a href="#cb19-26" tabindex="-1"></a>    target<span class="op">=</span>[<span class="st">"results.txt"</span>],</span>
<span id="cb19-27"><a href="#cb19-27" tabindex="-1"></a>    source<span class="op">=</span>[ZIPF_SOURCE] <span class="op">+</span> DATA_FILES,</span>
<span id="cb19-28"><a href="#cb19-28" tabindex="-1"></a>    action<span class="op">=</span>[<span class="st">"$</span><span class="sc">{language}</span><span class="st"> $</span><span class="sc">{zipf_source}</span><span class="st"> $</span><span class="sc">{SOURCES[1:]}</span><span class="st"> &gt; $</span><span class="sc">{TARGET}</span><span class="st">"</span>],</span>
<span id="cb19-29"><a href="#cb19-29" tabindex="-1"></a>    language<span class="op">=</span>LANGUAGE,</span>
<span id="cb19-30"><a href="#cb19-30" tabindex="-1"></a>    zipf_source<span class="op">=</span>ZIPF_SOURCE,</span>
<span id="cb19-31"><a href="#cb19-31" tabindex="-1"></a>)</span>
<span id="cb19-32"><a href="#cb19-32" tabindex="-1"></a></span>
<span id="cb19-33"><a href="#cb19-33" tabindex="-1"></a>env.Default([<span class="st">"results.txt"</span>])</span></code></pre>
</div>
<p>and the supporting <code>scons_lesson_configuration.py</code>
module:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="im">import</span> pathlib</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a><span class="im">import</span> SCons.Script</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a>COUNT_SOURCE <span class="op">=</span> <span class="st">"countwords.py"</span></span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a>LANGUAGE <span class="op">=</span> <span class="st">"python"</span></span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a>ZIPF_SOURCE <span class="op">=</span> <span class="st">"testzipf.py"</span></span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a>TEXT_FILES <span class="op">=</span> SCons.Script.Glob(<span class="st">"books/*.txt"</span>)</span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a>DATA_FILES <span class="op">=</span> [</span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a>    pathlib.Path(<span class="bu">str</span>(text_file)).with_suffix(<span class="st">".dat"</span>).name</span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a>    <span class="cf">for</span> text_file <span class="kw">in</span> TEXT_FILES</span>
<span id="cb20-12"><a href="#cb20-12" tabindex="-1"></a>]</span>
<span id="cb20-13"><a href="#cb20-13" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" tabindex="-1"></a></span>
<span id="cb20-15"><a href="#cb20-15" tabindex="-1"></a><span class="kw">def</span> count_words(env, data_files, language<span class="op">=</span>LANGUAGE, count_source<span class="op">=</span>COUNT_SOURCE):</span>
<span id="cb20-16"><a href="#cb20-16" tabindex="-1"></a>    <span class="co">"""Pseudo-builder to produce `.dat` targets from the `countwords.py` script</span></span>
<span id="cb20-17"><a href="#cb20-17" tabindex="-1"></a></span>
<span id="cb20-18"><a href="#cb20-18" tabindex="-1"></a><span class="co">    Assumes that the source text files are found in `books/{data_file}.txt`</span></span>
<span id="cb20-19"><a href="#cb20-19" tabindex="-1"></a></span>
<span id="cb20-20"><a href="#cb20-20" tabindex="-1"></a><span class="co">    :param env: SCons construction environment. Do not provide when using this</span></span>
<span id="cb20-21"><a href="#cb20-21" tabindex="-1"></a><span class="co">        function with the `env.AddMethod` and `env.CountWords` access style.</span></span>
<span id="cb20-22"><a href="#cb20-22" tabindex="-1"></a><span class="co">    :param data_files: List of string names of the data files to create.</span></span>
<span id="cb20-23"><a href="#cb20-23" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb20-24"><a href="#cb20-24" tabindex="-1"></a>    target_nodes <span class="op">=</span> []</span>
<span id="cb20-25"><a href="#cb20-25" tabindex="-1"></a>    <span class="cf">for</span> data_file <span class="kw">in</span> data_files:</span>
<span id="cb20-26"><a href="#cb20-26" tabindex="-1"></a>        data_path <span class="op">=</span> pathlib.Path(data_file)</span>
<span id="cb20-27"><a href="#cb20-27" tabindex="-1"></a>        text_file <span class="op">=</span> pathlib.Path(<span class="st">"books"</span>) <span class="op">/</span> data_path.with_suffix(<span class="st">".txt"</span>)</span>
<span id="cb20-28"><a href="#cb20-28" tabindex="-1"></a>        target_nodes.extend(</span>
<span id="cb20-29"><a href="#cb20-29" tabindex="-1"></a>            env.Command(</span>
<span id="cb20-30"><a href="#cb20-30" tabindex="-1"></a>                target<span class="op">=</span>[data_file],</span>
<span id="cb20-31"><a href="#cb20-31" tabindex="-1"></a>                source<span class="op">=</span>[text_file, count_source],</span>
<span id="cb20-32"><a href="#cb20-32" tabindex="-1"></a>                action<span class="op">=</span>[<span class="st">"$</span><span class="sc">{language}</span><span class="st"> $</span><span class="sc">{count_source}</span><span class="st"> $</span><span class="sc">{SOURCES[0]}</span><span class="st"> $</span><span class="sc">{TARGET}</span><span class="st">"</span>],</span>
<span id="cb20-33"><a href="#cb20-33" tabindex="-1"></a>                language<span class="op">=</span>language,</span>
<span id="cb20-34"><a href="#cb20-34" tabindex="-1"></a>                count_source<span class="op">=</span>count_source,</span>
<span id="cb20-35"><a href="#cb20-35" tabindex="-1"></a>            )</span>
<span id="cb20-36"><a href="#cb20-36" tabindex="-1"></a>        )</span>
<span id="cb20-37"><a href="#cb20-37" tabindex="-1"></a>    <span class="cf">return</span> target_nodes</span></code></pre>
</div>
<p>The following figure shows the dependencies embodied within our
SConstruct file, involved in building the <code>results.txt</code>
target, now we have introduced our function:</p>
<figure><img src="../fig/07-functions.png" title="results.txt dependencies after introducing a function" alt="results.txt dependencies after introducing a function" class="figure mx-auto d-block"></figure><div id="where-we-are" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="where-we-are" class="callout-inner">
<h3 class="callout-title">Where We Are</h3>
<div class="callout-content">
<p><a href="../files/code/07-functions/SConstruct">This SConstruct file</a>
and this <a href="../files/code/07-functions/scons_lesson_configuration.py">Python
module</a> contain all of our work so far.</p>
</div>
</div>
</div>
<div id="adding-more-books" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="adding-more-books" class="callout-inner">
<h3 class="callout-title">Adding more books</h3>
<div class="callout-content">
<p>We can now do a better job at testing Zipf’s rule by adding more
books. The books we have used come from the <a href="https://www.gutenberg.org/" class="external-link">Project Gutenberg</a> website. Project
Gutenberg offers thousands of free ebooks to download.</p>
<p><strong>Exercise instructions:</strong></p>
<ul>
<li>go to <a href="https://www.gutenberg.org/" class="external-link">Project Gutenberg</a> and
use the search box to find another book, for example <a href="https://www.gutenberg.org/ebooks/174" class="external-link">‘The Picture of Dorian
Gray’</a> from Oscar Wilde.</li>
<li>download the ‘Plain Text UTF-8’ version and save it to the
<code>books</code> folder; choose a short name for the file
(<strong>that doesn’t include spaces</strong>) e.g. “dorian_gray.txt”
because the filename is going to be used in the <code>results.txt</code>
file</li>
<li>optionally, open the file in a text editor and remove extraneous
text at the beginning and end (look for the phrase
<code>END OF THE PROJECT GUTENBERG EBOOK [title]</code>)</li>
<li>run <code>scons</code> and check that the correct commands are run,
given the dependency tree</li>
<li>check the results.txt file to see how this book compares to the
others</li>
</ul>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>SCons uses the Python programming language with acces to all of
Python’s many built-in functions.</li>
<li>SCons provides many functions that work natively with the internal
node objects required to manage the SCons directed graph.</li>
<li>Use the SCons <code>Glob</code> function to get lists of SCons nodes
from file names matching a pattern.</li>
<li>Use Python built-in and standard library modules to manage file
names and paths.</li>
</ul>
</div>
</div>
</div></section><section id="aio-08-self-doc"><p>Content from <a href="08-self-doc.html">Self-Documenting SConstruct files</a></p>
<hr>
<p>Last updated on 2025-04-16 |

        <a href="https://github.com/swcarpentry/scons-novice/edit/main/episodes/08-self-doc.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 10 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How should I document an SConscript file?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Write self-documenting SConstruct files with built-in help.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Many bash commands, and programs that people have written that can be
run from within bash, support a <code>--help</code> flag to display more
information on how to use the commands or programs. In this spirit, it
can be useful, both for ourselves and for others, to provide a
<code>--help</code> option in our SConstruct file. This can provide a
summary of the names of the key targets and what they do, so we don’t
need to look at the SConstruct file itself unless we want to.</p>
<p>SCons provides the common <code>--help</code> flag and a
<code>Help</code> function for building user customizable help messages.
The less common <code>-H</code> flag will print the SCons help message.
For our SConstruct file, running with <code>--help</code> option might
print:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">$</span> scons <span class="at">--help</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Local Options:
  --variables  Print the text files returned by Glob and exit (default: False)

Default Targets:
  results.txt

Aliases:
  dats</code></pre>
</div>
<p>Where SCons is composing the help message for our custom command-line
options for us already. So, how would we implement this? We could call
<code>Help</code> like:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>help_message <span class="op">=</span> <span class="st">"</span><span class="ch">\n\n</span><span class="st">Default Targets:</span><span class="ch">\n</span><span class="st">  results.txt</span><span class="ch">\n\n</span><span class="st">Aliases:</span><span class="ch">\n</span><span class="st">  dats"</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>env.Help(help_message, append<span class="op">=</span><span class="va">True</span>, keep_local<span class="op">=</span><span class="va">True</span>)</span></code></pre>
</div>
<p>But every time we add or remove a task, or change the default target
list, we would have to update the help message string manually. It would
be better if we could construct the list of default targets and aliases
from the configured tasks. We can use the SCons <code>default_ans</code>
and <code>DEFAULT_TARGETS</code> variables. First update the imports at
the top of the <code>scons_lesson_configuration.py</code> file</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="im">import</span> pathlib</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="im">import</span> SCons.Script</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="im">from</span> SCons.Script <span class="im">import</span> DEFAULT_TARGETS</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="im">from</span> SCons.Node.Alias <span class="im">import</span> default_ans</span></code></pre>
</div>
<p>Then add new help message construction functions at the bottom of the
<code>scons_lesson_configuration.py</code> file.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="kw">def</span> return_help_content(nodes, message<span class="op">=</span><span class="st">""</span>, help_content<span class="op">=</span><span class="bu">dict</span>()):</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>    <span class="co">"""Return a dictionary of {node: message} string pairs</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co">    Helpful in constructing help content for :meth:`project_help`. Will not</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co">    overwrite existing keys.</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="co">    :param nodes: SCons node objects, e.g. targets and aliases</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="co">    :param str message: Help message to assign to every node in nodes</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co">    :param dict help_content: Optional dictionary with target help messages</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="co">        ``{target: help}``</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="co">    :returns: Dictionary of {node: message} string pairs</span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="co">    :rtype: dict</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>    new_help_content <span class="op">=</span> {<span class="bu">str</span>(node): message <span class="cf">for</span> node <span class="kw">in</span> nodes}</span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a>    new_help_content.update(help_content)</span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a>    <span class="cf">return</span> new_help_content</span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a><span class="kw">def</span> project_help(help_content<span class="op">=</span><span class="bu">dict</span>()):</span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a>    <span class="co">"""Append the SCons help message with default targets and aliases</span></span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a><span class="co">    Must come *after* all default targets and aliases are defined.</span></span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a><span class="co">    :param dict help_content: Optional dictionary with target help messages</span></span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a><span class="co">        ``{target: help}``</span></span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a>    <span class="kw">def</span> add_content(nodes, message<span class="op">=</span><span class="st">""</span>, help_content<span class="op">=</span>help_content):</span>
<span id="cb5-29"><a href="#cb5-29" tabindex="-1"></a>        <span class="co">"""Append a help message for all nodes using provided help content if</span></span>
<span id="cb5-30"><a href="#cb5-30" tabindex="-1"></a><span class="co">        available.</span></span>
<span id="cb5-31"><a href="#cb5-31" tabindex="-1"></a></span>
<span id="cb5-32"><a href="#cb5-32" tabindex="-1"></a><span class="co">        :param nodes: SCons node objects, e.g. targets and aliases</span></span>
<span id="cb5-33"><a href="#cb5-33" tabindex="-1"></a><span class="co">        :param str message: Help message to assign to every node in nodes</span></span>
<span id="cb5-34"><a href="#cb5-34" tabindex="-1"></a><span class="co">        :param dict help_content: Optional dictionary with target help messages</span></span>
<span id="cb5-35"><a href="#cb5-35" tabindex="-1"></a><span class="co">            ``{target: help}``</span></span>
<span id="cb5-36"><a href="#cb5-36" tabindex="-1"></a></span>
<span id="cb5-37"><a href="#cb5-37" tabindex="-1"></a><span class="co">        :returns: appended help message</span></span>
<span id="cb5-38"><a href="#cb5-38" tabindex="-1"></a><span class="co">        :rtype: str</span></span>
<span id="cb5-39"><a href="#cb5-39" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb5-40"><a href="#cb5-40" tabindex="-1"></a>        keys <span class="op">=</span> [<span class="bu">str</span>(node) <span class="cf">for</span> node <span class="kw">in</span> nodes]</span>
<span id="cb5-41"><a href="#cb5-41" tabindex="-1"></a>        <span class="cf">for</span> key <span class="kw">in</span> keys:</span>
<span id="cb5-42"><a href="#cb5-42" tabindex="-1"></a>            <span class="cf">if</span> key <span class="kw">in</span> help_content.keys():</span>
<span id="cb5-43"><a href="#cb5-43" tabindex="-1"></a>                message <span class="op">+=</span> <span class="ss">f"    </span><span class="sc">{</span>key<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>help_content[key]<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb5-44"><a href="#cb5-44" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb5-45"><a href="#cb5-45" tabindex="-1"></a>                message <span class="op">+=</span> <span class="ss">f"    </span><span class="sc">{</span>key<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb5-46"><a href="#cb5-46" tabindex="-1"></a>        <span class="cf">return</span> message</span>
<span id="cb5-47"><a href="#cb5-47" tabindex="-1"></a></span>
<span id="cb5-48"><a href="#cb5-48" tabindex="-1"></a>    defaults_message <span class="op">=</span> add_content(</span>
<span id="cb5-49"><a href="#cb5-49" tabindex="-1"></a>        DEFAULT_TARGETS, message<span class="op">=</span><span class="st">"</span><span class="ch">\n</span><span class="st">Default Targets:</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb5-50"><a href="#cb5-50" tabindex="-1"></a>    )</span>
<span id="cb5-51"><a href="#cb5-51" tabindex="-1"></a>    alias_message <span class="op">=</span> add_content(default_ans, message<span class="op">=</span><span class="st">"</span><span class="ch">\n</span><span class="st">Target Aliases:</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb5-52"><a href="#cb5-52" tabindex="-1"></a>    SCons.Script.Help(</span>
<span id="cb5-53"><a href="#cb5-53" tabindex="-1"></a>        defaults_message <span class="op">+</span> alias_message, append<span class="op">=</span><span class="va">True</span>, keep_local<span class="op">=</span><span class="va">True</span></span>
<span id="cb5-54"><a href="#cb5-54" tabindex="-1"></a>    )</span></code></pre>
</div>
<p>Finally, update the bottom of the <code>SConstruct</code> file with
the new function calls. It is important that the
<code>project_help</code> call comes <em>after</em> all default targets
are assigned and all aliases are created.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>dats <span class="op">=</span> env.Alias(<span class="st">"dats"</span>, DATA_FILES)</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>help_content <span class="op">=</span> return_help_content(</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>    dats,</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>    <span class="st">"Count words in text files."</span>,</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>)</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>results <span class="op">=</span> env.Command(</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>    target<span class="op">=</span>[<span class="st">"results.txt"</span>],</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>    source<span class="op">=</span>[ZIPF_SOURCE] <span class="op">+</span> DATA_FILES,</span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>    action<span class="op">=</span>[<span class="st">"$</span><span class="sc">{language}</span><span class="st"> $</span><span class="sc">{zipf_source}</span><span class="st"> $</span><span class="sc">{SOURCES[1:]}</span><span class="st"> &gt; $</span><span class="sc">{TARGET}</span><span class="st">"</span>],</span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>    language<span class="op">=</span>LANGUAGE,</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>    zipf_source<span class="op">=</span>ZIPF_SOURCE,</span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a>)</span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>help_content <span class="op">=</span> return_help_content(</span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>    results,</span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a>    <span class="st">"Generate Zipf summary table."</span>,</span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a>    help_content,</span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a>)</span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a>env.Default([<span class="st">"results.txt"</span>])</span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a></span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a>project_help(help_content)</span></code></pre>
</div>
<p>If we now run</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">$</span> scons <span class="at">--help</span></span></code></pre>
</div>
<p>we get some SCons status messages, our help message, and the hint for
the full SCons help message:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>scons: Reading SConscript files ...
scons: done reading SConscript files.
Local Options:
  --variables  Print the files returned by Glob and exit (default: 'False')

Default Targets:
    results.txt: Generate Zipf summary table.

Target Aliases:
    dats: Count words in text files.

Use scons -H for help about SCons built-in command-line options.</code></pre>
</div>
<p>If we add, change or remove a default target or alias, we will
automatically see updated lists in our help messages.</p>
<div id="where-we-are" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="where-we-are" class="callout-inner">
<h3 class="callout-title">Where We Are</h3>
<div class="callout-content">
<p><a href="../files/code/08-self-doc/SConstruct">This SConstruct file</a>
and this <a href="../files/code/08-self-doc/scons_lesson_configuration.py">Python
module</a> contain all of our work so far.</p>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Document SConstruct options, targets, and aliases with the SCons
<code>default_ans</code> and <code>DEFAULT_TARGETS</code> variables and
the <code>Help</code> function.</li>
</ul>
</div>
</div>
</div></section><section id="aio-09-conclusion"><p>Content from <a href="09-conclusion.html">Conclusion</a></p>
<hr>
<p>Last updated on 2025-04-16 |

        <a href="https://github.com/swcarpentry/scons-novice/edit/main/episodes/09-conclusion.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 35 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What are the advantages and disadvantages of using tools like
SCons?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Understand advantages of automated build tools such as SCons.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Automated build tools such as SCons can help us in a number of ways.
They help us to automate repetitive commands, hence saving us time and
reducing the likelihood of errors compared with running these commands
manually.</p>
<p>They can also save time by ensuring that automatically-generated
artifacts (such as data files or plots) are only recreated when the
files that were used to create these have changed in some way.</p>
<p>Through their notion of targets, sources, and actions, they serve as
a form of documentation, recording dependencies between code, scripts,
tools, configurations, raw data, derived data, plots, and papers.</p>
<div id="creating-pngs" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="creating-pngs" class="callout-inner">
<h3 class="callout-title">Creating PNGs</h3>
<div class="callout-content">
<p>Add new rules, update existing rules, and add new variables to:</p>
<ul>
<li>Create <code>.png</code> files from <code>.dat</code> files using
<code>plotcounts.py</code>.</li>
<li>Update the default target to include the <code>.png</code>
files.</li>
<li>Remove all auto-generated files (<code>.dat</code>,
<code>.png</code>, <code>results.txt</code>).</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p><a href="../files/code/09-conclusion-challenge-1/SConstruct">This
SConstruct file</a> and this <a href="../files/code/09-conclusion-challenge-1/scons_lesson_configuration.py">Python
module</a> contain a simple solution to this challenge.</p>
<p>Can you think of a way to reduce duplication in
<code>count_words</code> and <code>plot_counts</code> functions?</p>
<p>To remove all targets, use the SCons special ‘<code>.</code>’ target
and the <code>--clean</code> flag.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">scons</span> . <span class="at">--clean</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>The following figure shows the dependencies involved in building the
‘<code>.</code>’ or ‘all’ target, once we’ve added support for
images:</p>
<figure><img src="../fig/09-conclusion-challenge-1.png" title="results.txt dependencies once images have been added" alt="results.txt dependencies once images have been added" class="figure mx-auto d-block"></figure><div id="creating-an-archive" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="creating-an-archive" class="callout-inner">
<h3 class="callout-title">Creating an Archive</h3>
<div class="callout-content">
<p>Often it is useful to create an archive file of your project that
includes all data, code and results. An archive file can package many
files into a single file that can easily be downloaded and shared with
collaborators. We can add steps to create the archive file inside the
SConstruct itself so it’s easy to update our archive file as the project
changes.</p>
<p>Edit the SConstruct to create an archive file of your project. Add
new rules, update existing rules and add new variables to:</p>
<ul>
<li><p>Create a <code>zipf_analysis.tar.gz</code> archive including our
code, data, plots, the Zipf summary table, the SConstruct file with the
SCons <a href="https://scons.org/doc/production/HTML/scons-man.html#b-Tar" class="external-link"><code>Tar</code>
builder</a>.</p></li>
<li><p>Update the default targets list so that it creates
<code>zipf_analysis.tar.gz</code>.</p></li>
<li><p>Print the values of any additional variables you have defined
when <code>scons --variables</code> is called.</p></li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p><a href="../files/code/09-conclusion-challenge-2/SConstruct">This
SConstruct file</a> and this <a href="../files/code/09-conclusion-challenge-2/scons_lesson_configuration.py">Python
module</a> contain a simple solution to this challenge.</p>
</div>
</div>
</div>
</div>
<div id="archiving-the-sconstruct-file" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="archiving-the-sconstruct-file" class="callout-inner">
<h3 class="callout-title">Archiving the SConstruct file</h3>
<div class="callout-content">
<p>Why does the SCons task for the archive directory add the SConstruct
to our archive of code, data, plots and Zipf summary table?</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<p>Our code files (<code>countwords.py</code>,
<code>plotcounts.py</code>, <code>testzipf.py</code>) implement the
individual parts of our workflow. They allow us to create
<code>.dat</code> files from <code>.txt</code> files, and
<code>results.txt</code> and <code>.png</code> files from
<code>.dat</code> files. Our SConstruct file, however, documents
dependencies between our code, raw data, derived data, and plots, as
well as implementing our workflow as a whole.</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>SCons and SConscript files save time by automating repetitive work,
and save thinking by documenting how to reproduce results.</li>
</ul>
</div>
</div>
</div></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/swcarpentry/scons-novice/edit/main/README.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/swcarpentry/scons-novice/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/swcarpentry/scons-novice/" class="external-link">Source</a></p>
				<p><a href="https://github.com/swcarpentry/scons-novice/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:team@carpentries.org">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.12" class="external-link">sandpaper (0.16.12)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.9" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.6" class="external-link">varnish (1.0.6)</a></p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "LearningResource",
  "@id": "https://swcarpentry.github.io/scons-novice/instructor/aio.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/LearningResource/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://swcarpentry.github.io/scons-novice/instructor/aio.html",
  "identifier": "https://swcarpentry.github.io/scons-novice/instructor/aio.html",
  "dateCreated": "2015-06-18",
  "dateModified": "2025-05-13",
  "datePublished": "2025-05-13"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo --><script>
          var _paq = window._paq = window._paq || [];
          /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
          _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
          _paq.push(["setDomains", ["*.lessons.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
          _paq.push(["setDoNotTrack", true]);
          _paq.push(["disableCookies"]);
          _paq.push(["trackPageView"]);
          _paq.push(["enableLinkTracking"]);
          (function() {
              var u="https://matomo.carpentries.org/";
              _paq.push(["setTrackerUrl", u+"matomo.php"]);
              _paq.push(["setSiteId", "1"]);
              var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0];
              g.async=true; g.src="https://matomo.carpentries.org/matomo.js"; s.parentNode.insertBefore(g,s);
          })();
        </script><!-- End Matomo Code -->
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

